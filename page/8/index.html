<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="haitian的博客">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="haitian的博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="haitian的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/8/"/>





  <title>haitian的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">haitian的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">为了更好的生活而奋斗!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/28/in-linux-the-file-size-is-inconsistent-and-the-file-is-empty/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/28/in-linux-the-file-size-is-inconsistent-and-the-file-is-empty/" itemprop="url">linux下文件大小不一致的情况分析，文件空洞</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-28T16:49:08+08:00">
                2010-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>df 显示的已使用磁盘占用率比du 统计出来的结果要大很多。原因，主要是由于两者计算结果的方式不同。</p>
<p>一、实验情况</p>
<p>1、创建并删除文件</p>
<p>创建文件前的磁盘容量情况：</p>
<p># df -h</p>
<p>文件系统              容量  已用 可用 已用% 挂载点</p>
<p>/dev/sda1              12G  5.7G  5.5G  51% /</p>
<p>tmpfs                 506M     0  506M   0% /dev/shm</p>
<p>创建文件：</p>
<p># dd if=/dev/zero of=test.iso bs=1024k count=1000</p>
<p>1000+0 records in</p>
<p>1000+0 records out</p>
<p>1048576000 bytes (1.0 GB) copied, 14.3055 seconds, 73.3 MB/s</p>
<p>现在的磁盘情况：</p>
<p># df -h</p>
<p>文件系统              容量  已用 可用 已用% 挂载点</p>
<p>/dev/sda1              12G  6.7G  4.6G  60% /</p>
<p>tmpfs                 506M     0  506M   0% /dev/shm</p>
<p>模拟某个进程正在使用该文件：</p>
<h1 id="tail-f-tmp-test-iso"><a href="#tail-f-tmp-test-iso" class="headerlink" title="tail -f /tmp/test.iso"></a>tail -f /tmp/test.iso</h1><p>2、删除该文件</p>
<p>打开另一个终端，登陆到系统中。</p>
<p>查看是否有进程正在使用上面创建的文件：</p>
<p># lsof |grep test.iso</p>
<p>tail      2175      root    3r      REG        8,1 1048576000     752972 /tmp/test.iso</p>
<p>把该文件删掉，并确认：</p>
<p># rm /tmp/test.iso</p>
<p>rm：是否删除 一般文件 “/tmp/test.iso”? y</p>
<p># ls /tmp/test.iso</p>
<p>ls: /tmp/test.iso: 没有那个文件或目录</p>
<p>查看是否还有进程在使用（注意结尾的标记）：</p>
<p># lsof |grep test.iso</p>
<p>tail      2175      root    3r      REG        8,1 1048576000     752972 /tmp/test.iso (deleted)</p>
<p>查看磁盘使用情况：</p>
<p># df -h</p>
<p>文件系统              容量  已用 可用 已用% 挂载点</p>
<p>/dev/sda1              12G  6.7G  4.6G  60% /</p>
<p>tmpfs                 506M     0  506M   0% /dev/shm</p>
<p># cat /proc/diskstats |grep sda1</p>
<p>   8    1 sda1 54385 5184 1626626 130090 20434 635997 5251448 5345733 0 111685 5475829</p>
<p>可见，虽然从ls 已经无法找到该文件，但因为tail 进程仍在使用该文件，故实际上内核并没有把这文件所占用的空间释放出来（df 的结果）。</p>
<p>3、停止相关进程</p>
<p>回到第一终端，用Ctrl+C 终止tail 进程，查看结果：</p>
<p># df -h</p>
<p>文件系统              容量  已用 可用 已用% 挂载点</p>
<p>/dev/sda1              12G  5.7G  5.5G  51% /</p>
<p>tmpfs                 506M     0  506M   0% /dev/shm</p>
<p># cat /proc/diskstats |grep sda1</p>
<p>   8    1 sda1 54473 5184 1627402 130617 20453 636042 5251960 5345756 0 112226 5476379</p>
<p>至此，文件所占用的空间已完全释放。</p>
<p>二、说明</p>
<p>从上面的实验，可得出一些情况：</p>
<p>1、若有进程在占用某个文件，而其他进程把这文件删掉，只会删除其在磁盘中的标记，而不会释放其占用的磁盘空间；直到所有访问该文件的进程退出为止；</p>
<p>2、df 是从内核中获取磁盘占用情况数据的，而du是统计当前磁盘文件大小的结果，由于磁盘标记已被删掉，因此du 不会计算上述被删除文件的空间，导致df 与 du的结果不一致。</p>
<p>三、解决问题</p>
<p>通常的解决方法有两个：</p>
<p>1、把占用文件的相关进程关闭</p>
<p>这可通过下面的命令得到这些已被删除，但未释放空间的文件和进程信息：</p>
<p># lsof |grep deleted </p>
<p>找到这些进程后，在安全的情况下把其关闭，空间自会马上释放。</p>
<p>2、以清空的方式替代删除</p>
<p>归根到底，产生问题的原因是，访问该文件的文件指针（句柄），在rm 动作后，因为进程仍在访问，因此，仍处在文件里面（中间或结尾处）。所以，如果用清空的方式，把文件指针重置，该文件所占用的空间也会马上释放出来。</p>
<p># echo &gt; /tmp/test.iso</p>
<p># df -h</p>
<p>文件系统              容量  已用 可用 已用% 挂载点</p>
<p>/dev/sda1              12G  5.7G  5.5G  51% /</p>
<p>tmpfs                 506M     0  506M   0% /dev/shm</p>
<p># tail -f /tmp/test.iso</p>
<p>tail: /tmp/test.iso: file truncated</p>
<p>所以，对于常发生类似问题的文件，如：日志记录文件等。以改名、清空、删除的顺序操作可避免问题。</p>
<p>四、补充</p>
<p>除rm外，有些不明显的操作，也会产生类似的问题。</p>
<p>例如 gzip 命令，其对某个文件xxx.log进行压缩时，会产生一个新的xxx.log.gz文件，完成后，会把原来的xxx.log删除。</p>
<p>这时，若仍有进程在使用xxx.log文件，那么，实际上，该文件还是只会标记为deleted，其空间也不会释放，问题与上面提到的情况是相同的。所以，在编写脚本时，可先判断是否仍有进程正在使用该文件，然后再进行gzip 操作。</p>
<p>五 文件空洞</p>
<p>   文件读写时，如果先文件指针偏移很大一段，然后写入1byte；这样这个文件实际占用1byte空间，但是stat查看文件大小，或者读写时，都会发现文件很大；所有没有写内容的都返回0，且不占用空间，这样的文件叫 ‘sparse file’，即文件空洞</p>
<pre><code>容易发生在一个进程在写一个文件，这是人工进行清空文件操作，就会产生。
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/27/linux-has-less-than-4g-available-memory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/27/linux-has-less-than-4g-available-memory/" itemprop="url">linux下可用内存只有不到4G</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-27T17:57:49+08:00">
                2010-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>硬件没报错，free -m查出的总内存还不到4G，最后居然是升级kernel时，没有升级成kernel-pae版本，而是标准的版本，所以内核可控制的总内存就有限，呵呵。。</p>
<p>操作系统在32bit x86平台上最大寻址空间只有4GB，如果要使用大于4GB的内存，就必须使用Intel的PAE（物理地址扩展）模式。在Windows NT平台实现PAE只需要对boot.ini加上/pae即可。而对于RHEL5，缺省安装模式下是不允许检测超过4GB内存，所以我们需要在内核安装完毕后再安装kernel-PAE套件。  </p>
<p>x86平台的硬件支持两级页表，Intel Pentium pro以上的型号均支持PAE和三级页表，使得系统最大寻址达到36位，就是64GB的内存。但是系统进程运行时使用的永远是虚拟地址，在32位字长的i386机器上，一个进程永远无法访问超出4G的字节。kernel只能通过拼凑的方式计算出大于4G的内存地址。  </p>
<p>在Linux kernel配置项里有High Memmory Support, 如果总内存小于等于1G的选”off”,大于4G的选”64G”<br>Note: Linux can use up to 64 Gigabytes of physical memory on x86 systems. However, the address space of 32-bit x86 processors is only 4 Gigabytes large. Thus means that, if you have a large amount of physical memory, not all of it can be “permanently mapped” by the kernel. The physical memory that’s not permanently mapped is called “high memory”.  </p>
<p>还有一项Allocate 3rd-level pagetables from highmem，使用这一项可以在内存很多(大于4G)的机器上将用户空间的页表放到高位内存区,以节约宝贵的低端内存。  </p>
<p>缺省安装的内核不允许红帽企业 Linux 5检测超过 4GB 的内存。因此，如果你的系统有超过 4GB 的内存，你将需要在内核安装完毕后再安装 kernel-PAE 套件。</p>
<p>关解决方法如下：</p>
<p>主要需要2个方面设置：</p>
<p>1.bios:在bios里开启对大内存的设置</p>
<p>2.安装支持大内存的kernel</p>
<p>centos 5.0 默认安装 for i386的内核不支持 4g+的内存需要安装上kernel-PAE（原kernel-hugemem包）操作很简单！</p>
<p>1.#yum install kernel-PAE</p>
<p>2.#vi /boot/grub/grub.conf</p>
<p>boot=/dev/md0</p>
<p>default=0</p>
<p>timeout=5</p>
<p>splashimage=(hd0,0)/grub/splash.xpm.gz hiddenmenu</p>
<p>修改设置为默认启动 default=0</p>
<p>3.#init 6</p>
<p>重启服务器后我们可以free发现正常</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/27/whether-it-is-because-of-the-bnx2id-startup-and-the-network-card-down/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/27/whether-it-is-because-of-the-bnx2id-startup-and-the-network-card-down/" itemprop="url">是否是因为bnx2id的启动而引起的网卡down</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-27T11:14:17+08:00">
                2010-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在安装redhat as5.4系统上默认的Broadcom NetXtreme II BCM 5709驱动为1.9.3，经常出现网卡会down的情况。经和dell沟通后，将网卡的驱动降为1.9.20d，降级后很久没有再出现过问题，</p>
<p>后来在一台服务器上再次出现了网卡down的情况，经分析发现down的服务器上多了一个bnx2id的服务。是否是因为bnx2id的启动而引起的网卡down。谢谢！以下是一些服务器信息，如有需要进一步的信息，请联系！</p>
<p>网卡驱动模块信息</p>
<p>modinfo bnx2</p>
<p>filename:       /lib/modules/2.6.18-164.el5PAE/updates/bnx2.ko</p>
<p>version:        1.9.20d</p>
<p>license:        GPL</p>
<p>description:    Broadcom NetXtreme II BCM5706/5708/5709/5716 Driver</p>
<p>author:         Michael Chan &lt;<a href="mailto:mchan@broadcom.com" target="_blank" rel="noopener">mchan@broadcom.com</a>&gt;</p>
<p>srcversion:     44355DFF4A0181C084FA24C</p>
<p>alias:          pci:v000014E4d0000163Csv*sd*bc*sc*i*</p>
<p>alias:          pci:v000014E4d0000163Bsv*sd*bc*sc*i*</p>
<p>alias:          pci:v000014E4d0000163Asv*sd*bc*sc*i*</p>
<p>alias:          pci:v000014E4d00001639sv*sd*bc*sc*i*</p>
<p>alias:          pci:v000014E4d000016ACsv*sd*bc*sc*i*</p>
<p>alias:          pci:v000014E4d000016AAsv*sd*bc*sc*i*</p>
<p>alias:          pci:v000014E4d000016AAsv0000103Csd00003102bc*sc*i*</p>
<p>alias:          pci:v000014E4d0000164Csv*sd*bc*sc*i*</p>
<p>alias:          pci:v000014E4d0000164Asv*sd*bc*sc*i*</p>
<p>alias:          pci:v000014E4d0000164Asv0000103Csd00003106bc*sc*i*</p>
<p>alias:          pci:v000014E4d0000164Asv0000103Csd00003101bc*sc*i*</p>
<p>depends:       </p>
<p>vermagic:       2.6.18-164.el5PAE SMP mod_unload 686 REGPARM 4KSTACKS gcc-4. 1</p>
<p>parm:           disable_msi:Disable Message Signaled Interrupt (MSI) (int)</p>
<p>chkconfig –list|grep bnx</p>
<p>bnx2id          0:on    1:on    2:on    3:on    4:on    5:on    6:on</p>
<p>bnx2id的服务启动脚本</p>
<p>cat /etc/init.d/bnx2id</p>
<p>#!/bin/sh</p>
<p>#</p>
<p># chkconfig: 345 6 90</p>
<p># description: Starts and stops Broadcom’s iSCSI initiator software</p>
<p>#</p>
<p># processname: bnx2id</p>
<p># pidfile: /var/run/bnx2id.pid</p>
<p># Source function library.</p>
<p>. /etc/init.d/functions</p>
<p>PATH=/sbin:/bin:/usr/sbin:/usr/bin</p>
<p>RETVAL=0</p>
<p>start()</p>
<p>{</p>
<pre><code>echo -n $&quot;Starting Broadcom iSCSI initiator software: &quot;

modprobe -q bnx2i

dev\_maj\_no=\`cat /proc/devices  | awk &apos;/bnx2i/{print $1}&apos;\`

\\rm -rf /dev/bnx2i

mknod /dev/bnx2i c ${dev\_maj\_no} 0

daemon bnx2id

RETVAL=$?

success

echo

[ $RETVAL -eq 0 ] || return
</code></pre><p>}</p>
<p>stop()</p>
<p>{</p>
<pre><code>echo -n $&quot;Stopping Broadcom iSCSI initiator software: &quot;

rmmod bnx2i 2&gt;/dev/null

rmmod cnic 2&gt;/dev/null

sleep 5

rm -f /var/run/bnx2id.pid

pkill -KILL bnx2id

success

echo
</code></pre><p>}</p>
<p>restart()</p>
<p>{</p>
<pre><code>stop

start
</code></pre><p>}</p>
<p>case “$1” in</p>
<pre><code>start)

                start

                ;;

stop)

                stop

                ;;

restart)

       ;          stop

                start

                ;;

status)

                status bnx2id

                RETVAL=$?

                ;;

*)

                echo $&quot;Usage: $0 {start|stop|restart|status}&quot;

                exit 1
</code></pre><p>esac</p>
<p>exit $RETVAL</p>
<p>操作系统版本</p>
<p>lsb_release -a</p>
<p>LSB Version:    :core-3.1-ia32:core-3.1-noarch:graphics-3.1-ia32:graphics-3.1-noarch</p>
<p>Distributor ID: RedHatEnterpriseServer</p>
<p>Description:    Red Hat Enterprise Linux Server release 5.4 (Tikanga)</p>
<p>Release:        5.4</p>
<p>Codename:       Tikanga</p>
<p>uname -a</p>
<p>Linux 192_168_167_41 2.6.18-164.el5PAE #1 SMP Tue Aug 18 15:59:11 EDT 2009 i686 i686 i386 GNU/Linux</p>
<p>硬件型号</p>
<p>dmidecode -t 1</p>
<p># dmidecode 2.9</p>
<p>SMBIOS 2.6 present.</p>
<p>Handle 0x0100, DMI type 1, 27 bytes</p>
<p>System Information</p>
<pre><code>Manufacturer: Dell Inc.

Product Name: PowerEdge R610

Version: Not Specified

Serial Number: XXXXXXX

UUID: 44454C4C-3600-1043-8033-B6C04F583258

Wake-up Type: Power Switch

SKU Number: Not Specified

Family: Not Specified
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/27/netdev-watchdog-eth0-transmit-timed-out-solution-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/27/netdev-watchdog-eth0-transmit-timed-out-solution-summary/" itemprop="url">“NETDEV WATCHDOG: eth0: transmit timed out”问题解决办法小结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-27T09:40:54+08:00">
                2010-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这个问题可真是疑难杂症了，从2001年甚至更早到2009年5月就在前几天，都有人在网上问这个问题，并且能得到答案的人很少，能最终解决了的更是少之又少。我也遇到了这个问题，经过千辛万苦终于找到了答案。这个问题的答案不只一个，我做个小结，你可以挨个试试，应该有一个适合你的情况。</p>
<p>先说我的情况。我以前是debian ＋ win2K 双系统。最近终于决定要升级到winxp了。在原来win的分区重新装了xp后，就出现这种问题了。可偏偏此前还升级了debian，并在xp下运行过p2pover之类的软件。所以问题原因就不好确定了。最后，确定原因是：winxp的网卡设置里有一项功能是在关闭xp时关闭网卡的网络唤醒（wake－on－lan）。而debian却偏偏不能把这个打开。这才出现了这个问题。解决办法呢，就是在winxp下，右键点击“网上邻居”，点击“属性”，在右键点击“本地连接”，再点“属性”-&gt;”配置”-&gt;”高级”，然后设置“Wake-on-LAN”为“enable”。然后重启，进入linux就可以联网了。</p>
<p>下面是我在搜索过程中看到的其他情况的解决办法：</p>
<p>1. 打开/boot/grub/menu.lst文件，在启动的核心kernel那行最后加上： acpi=off noapic。</p>
<p>   其中：1) acpi=off 禁止了一些电源高级管理功能，对你的应用程序没有影响。</p>
<pre><code>2）noapic 改变了中断方式，对应用也没有影响。  
</code></pre><p>   详见：<a href="http://blog.chinaunix.net/u/25264/showart_545308.html" target="_blank" rel="noopener">http://blog.chinaunix.net/u/25264/showart_545308.html</a><br>2. ethtool -K eth0 tso off<br>3. 重新装网卡驱动。<br>   rmmod r8169 &amp;&amp; modprobe r8169 &amp;&amp; update-modules<br>   或更彻底点重新下载个驱动安装，不一定下最新的，因为更新的驱动可能会不适合一些老网卡，所以老的驱动可能没有这个 问题。<br>4. 换用旧的内核试试。<br>5. 关闭ecn。 在文件/etc/sysctl.conf中加入 net.ipv4.tcp_ecn=0<br>6. 关闭IPV6支持。在文件/etc/modprobe.d/aliases中把alias net-pf-10 ipv6 替换成如下两行：<br>   alias net-pf-10 off<br>   alias ipv6 off<br>7. 强制设定网卡工作模式： mii-tool 100baseTx-HD<br>   100baseTx-HD 是100M双绞线全双工的意思。其他的可以mii-tool –help看看，或到网上查查。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/22/when-installing-the-green-version-of-vmware-the-presence-of-failed-to-initialize-the-remote-display-subsystem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/22/when-installing-the-green-version-of-vmware-the-presence-of-failed-to-initialize-the-remote-display-subsystem/" itemprop="url">安装绿色版vmware时出现提示“未能初始化远程显示子系统”</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-22T14:45:50+08:00">
                2010-12-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/默认分类/" itemprop="url" rel="index">
                    <span itemprop="name">默认分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>安装完成后，启动虚拟机时提示“未能初始化远程显示子系统。”、”找不到一个要连接的有效 peer 进程。”</p>
<p>解决方法：</p>
<p>右击我的电脑–管理—本地用户和组里面的用户一栏，查看右边，里面是否有个__vmware_user__的账户，没有的话可能是这个原因，创建一个试试，实在不可以尝试卸载重新安装试试吧，绿色版vm的要运行安装.bat之类的才可以用的。</p>
<p> 我之前运行安装的时候就是因为建立的帐户密码达不到域策略的密码强度所以建立用户失败，自己手动建立就好了</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/19/linux-looks-at-how-many-swap-partitions-or-exchange-files-are-used/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/19/linux-looks-at-how-many-swap-partitions-or-exchange-files-are-used/" itemprop="url">linux 查看有多少个交换分区或交换文件在使用的方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-19T15:30:15+08:00">
                2010-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>cat /proc/swaps</p>
<p>或swapon -s</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/14/how-to-install-gns3-on-centos-redhat-fedora/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/14/how-to-install-gns3-on-centos-redhat-fedora/" itemprop="url">How To Install GNS3 on Centos/Redhat/Fedora .</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-14T18:30:48+08:00">
                2010-12-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/默认分类/" itemprop="url" rel="index">
                    <span itemprop="name">默认分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>You won’t find detailed instructions for <a href="http://networkingtips-tricks.blogspot.com/" target="_blank" rel="noopener">GNS3</a> installation on Centos/Redhat/Fedora over the net, So I decided to make one for our certcollection members. Installing GNS3 on Centos/Redhat/Fedora can be very tedious task. But If you follow my Steps given below you can setup and run GNS3 without any difficulty. Since Qt 4.5.1 binary which is required for GNS3 is not available for these OS’s, we’ll have to compile it from the source.<br>IMP:: Installation of all this packages will take a lot of time. So do it when you are free.<br>OK lets roll<br>First we’ll have to install dependencies<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[user@admin ~]$ su  </span><br><span class="line">Password: (Type in your root password here)  </span><br><span class="line">[root@admin /]# yum install python python-devel xorg-x11-proto-devel libXext-devel  </span><br><span class="line">[root@admin /]# yum install gcc-c++  </span><br><span class="line">Now we&apos;ll download and install Qt4  </span><br><span class="line">[root@admin /]#cd /tmp  </span><br><span class="line">[root@admin tmp#wget http://ftp.uludag.org.tr/pub/source/2009/qt-x11-opensource-src-4.5.1.tar.gz  </span><br><span class="line">[root@admin tmp]#tar xzf qt-x11-opensource-src-4.5.1.tar.gz  </span><br><span class="line">[root@admin tmp]# cd qt-x11-opensource-src-4.5.1  </span><br><span class="line">[root@admin qt-x11-opensource-src-4.5.1]#./configure -nomake examples -nomake demos -qt-gif -no-exceptions -debug -qt3support  </span><br><span class="line">[root@admin qt-x11-opensource-src-4.5.1]#gmake &lt;====This might take 2-3 hrs.  </span><br><span class="line">[root@admin qt-x11-opensource-src-4.5.1]#gmake install &lt;====Another 30 mins or so  </span><br><span class="line">[root@admin qt-x11-opensource-src-4.5.1]#PATH=/usr/local/Trolltech/Qt-4.5.1/bin:$PATH  </span><br><span class="line">[root@admin qt-x11-opensource-src-4.5.1]#export PATH  </span><br><span class="line">Next we&apos;ll install SIP  </span><br><span class="line">[root@admin qt-x11-opensource-src-4.5.1]#cd ..  </span><br><span class="line">[root@admin tmp]#wget http://ftp.uludag.org.tr/pub/source/2009/sip-4.8.1.tar.gz  </span><br><span class="line">[root@admin tmp]#tar xzf sip-4.8.1.tar.gz  </span><br><span class="line">[root@admin tmp]#cd sip-4.8.1  </span><br><span class="line">[root@admin sip-4.8.1]#python configure.py  </span><br><span class="line">[root@admin sip-4.8.1]#make  </span><br><span class="line">[root@admin sip-4.8.1]#make install  </span><br><span class="line">Next we&apos;ll Install PyQt4  </span><br><span class="line">[root@admin sip-4.8.1]#cd ..  </span><br><span class="line">[root@admin tmp]#wget http://ftp.uludag.org.tr/pub/source/2009/PyQt-x11-gpl-4.5.2.tar.gz  </span><br><span class="line">[root@admin tmp]#tar xzf PyQt-x11-gpl-4.5.2.tar.gz  </span><br><span class="line">[root@admin tmp]#cd PyQt-x11-gpl-4.5.2  </span><br><span class="line">[root@admin PyQt-x11-gpl-4.5.2]#python configure.py  </span><br><span class="line">[root@admin PyQt-x11-gpl-4.5.2]#make &lt;=====This will take 30-60 mins  </span><br><span class="line">[root@admin PyQt-x11-gpl-4.5.2]#make install  </span><br><span class="line">We are done with compiling part, now lets download GNS3 source files  </span><br><span class="line">[root@admin tmp]#cd /opt  </span><br><span class="line">[root@admin opt]#wget http://space.dl.sourceforge.net/project/gns-3/GNS3/0.7.2/GNS3-0.7.2-src.tar.bz2  </span><br><span class="line">[root@admin opt]#tar -xjvf GNS3-0.7.2-src.tar.bz2 &amp;&amp; rm GNS3-0.7.2-src.tar.bz2  </span><br><span class="line">[root@admin opt]#mv GNS3-0.7.2-src /opt/GNS3  </span><br><span class="line">Create the following directories:  </span><br><span class="line">These directories will be used by GNS3 – such as projects – where your working projects will be stored, cache, temp, IOS images, etc.  </span><br><span class="line">[root@admin opt]#cd /opt/GNS3  </span><br><span class="line">[root@admin GNS3]#mkdir Dynamips  </span><br><span class="line">[root@admin GNS3]#mkdir IOS  </span><br><span class="line">[root@admin GNS3]#mkdir Project  </span><br><span class="line">[root@admin GNS3]#mkdir Cache  </span><br><span class="line">[root@admin GNS3]#mkdir tmp  </span><br><span class="line">[root@admin GNS3]#chmod o+rw -R ./Project  </span><br><span class="line">[root@admin GNS3]#chmod o+rw -R ./tmp  </span><br><span class="line">[root@admin GNS3]#chmod o+rw -R ./IOS  </span><br><span class="line">Download binary of dynamips and make it executable  </span><br><span class="line">[root@admin GNS3]#cd Dynamips  </span><br><span class="line">[root@admin Dynamips ]#wget http://www.ipflow.utc.fr/dynamips/dynamips-0.2.8-RC2-x86.bin  </span><br><span class="line">[root@admin Dynamips ]#chmod +x ./dynamips-0.2.8-RC2-x86.bin  </span><br><span class="line">IMP:: For 64-bit users  </span><br><span class="line">[root@admin Dynamips ]#wget http://www.ipflow.utc.fr/dynamips/dynamips-0.2.8-RC2-amd64.bin  </span><br><span class="line">[root@admin Dynamips ]#chmod +x ./dynamips-0.2.8-RC2-amd64.bin  </span><br><span class="line">You can create a desktop shortcut by right-clicking on the desktop and select “Create Launcher..”, Name it GNS3 and in the command section type in  </span><br><span class="line">python &quot;/opt/GNS3/gns3&quot;  </span><br><span class="line">Double click to open GNS3 and we will edit the default settings. If you don’t want to use desktop icons you can create a launcher from your programs menu by right clicking on the Main Menu, selecting Edit Menu. Select New Item on the right and you will be presented with the same window where you type in the above. From there you can move the launcher into any menu section of your choice.  </span><br><span class="line">Fire up GNS3  </span><br><span class="line">\* Go to edit | preferences and in the ‘Terminal command:’ section type in:  </span><br><span class="line">gnome-terminal -t %d -e &apos;telnet %h %p&apos; &gt; /dev/null 2&gt;&amp;1 &amp;  </span><br><span class="line">\* Under ‘Paths’ change the ‘Project directory:’ to  </span><br><span class="line">/opt/GNS3/Project  </span><br><span class="line">and the ‘IOS/PIX directory:’ to  </span><br><span class="line">/opt/GNS3/IOS  </span><br><span class="line">\* Click on Dynamips tab on the left  </span><br><span class="line">For the ‘Executable path:’ type in  </span><br><span class="line">/opt/GNS3/Dynamips/dynamips-0.2.8-RC2-x86.bin  </span><br><span class="line">\* Change the ‘Working directory:’ to  </span><br><span class="line">/opt/GNS3/tmp  </span><br><span class="line">Click on the Capture tab on the left  </span><br><span class="line">\* For the ‘Working directory for capture files:’ change it to  </span><br><span class="line">/opt/GNS3/Project  </span><br><span class="line">Imp:: When you want to stop the router, use right click stop on the router.  </span><br><span class="line">After you have done all that, you will be able to Open and Save your GNS3 projects properly and have an efficient setup for GNS3. In order to use the devices in GNS3 you must obtain our own IOS images from Cisco or http://networkingtips-tricks.blogspot.com/2010/03/cisco-ios-collection-for-gns3-and.html  </span><br><span class="line">Hope this tutorial will help you guys to setup and run GNS3 on your Linux system.  </span><br><span class="line">Just the right place to find a schadenfreude  </span><br><span class="line">Happy Learning</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/10/mysql-cluster-7-dynamically-adds-data-node-configuration-steps/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/10/mysql-cluster-7-dynamically-adds-data-node-configuration-steps/" itemprop="url">mysql cluster 7 动态增加数据节点配置步骤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-10T18:17:37+08:00">
                2010-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/默认分类/" itemprop="url" rel="index">
                    <span itemprop="name">默认分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Starting-configuration"><a href="#Starting-configuration" class="headerlink" title="Starting configuration."></a>Starting configuration.</h2><p>vi /usr/local/mysql/mysql-cluster/config.ini</p>
<p>[ndbd default]</p>
<p>DataMemory =100M</p>
<p>IndexMemory =100M</p>
<p>NoOfReplicas = 2</p>
<p>DataDir = /usr/local/mysql/var/mysql-cluster</p>
<p>[ndbd]</p>
<p>Id = 1</p>
<p>HostName = 172.20.86.188</p>
<p>[ndbd]</p>
<p>Id = 2</p>
<p>HostName = 172.20.86.189</p>
<p>[mgm]</p>
<p>HostName = 172.20.86.185</p>
<p>Id = 10</p>
<p>[mysqld]</p>
<p>Id=20</p>
<p>HostName = 172.20.86.185</p>
<p>2在185上运行ndb_mgm</p>
<p>Ndb_mgm&gt;show</p>
<p>-- NDB Cluster – Management Client –</p>
<p>ndb_mgm&gt;<code>**SHOW**</code></p>
<p>Connected to Management <strong>Server</strong> at: 172.20.86.185:1186</p>
<p>Cluster Configuration</p>
<p>---------------------</p>
<p>[ndbd(NDB)]2 node(s)</p>
<p><a href="mailto:id=1@172.20.86.188" target="_blank" rel="noopener">id=1@172.20.86.188</a>(5.1.32-ndb-7.0.5, Nodegroup: 0, Master)</p>
<p><a href="mailto:id=2@172.20.86.189" target="_blank" rel="noopener">id=2@172.20.86.189</a>(5.1.32-ndb-7.0.5, Nodegroup: 0)</p>
<p>[ndb_mgmd(MGM)] 1 node(s)</p>
<p><a href="mailto:id=10@172.20.86.185" target="_blank" rel="noopener">id=10@172.20.86.185</a>(5.1.32-ndb-7.0.5)</p>
<p>[mysqld(API)]2 node(s)</p>
<p><a href="mailto:id=20@172.20.86.185" target="_blank" rel="noopener">id=20@172.20.86.185</a>(5.1.32-ndb-7.0.5)</p>
<h2 id="Step-1-Update-configuration-file"><a href="#Step-1-Update-configuration-file" class="headerlink" title="Step 1: Update configuration file"></a>Step 1: Update configuration file</h2><p>[ndbd default]</p>
<p>DataMemory =100M</p>
<p>IndexMemory =100M</p>
<p>NoOfReplicas = 2</p>
<p>DataDir = /usr/local/mysql/var/mysql-cluster</p>
<p>[ndbd]</p>
<p>Id = 1</p>
<p>HostName = 172.20.86.188</p>
<p>[ndbd]</p>
<p>Id = 2</p>
<p>HostName = 172.20.86.189</p>
<p><strong>[ndbd]</strong></p>
<p><strong>Id = 3</strong></p>
<p><strong>HostName**</strong>=<strong>**172.20.86.187</strong></p>
<p><strong>[ndbd]</strong></p>
<p><strong>Id = 4</strong></p>
<p><strong>HostName**</strong>=<strong>**172.20.86.186</strong></p>
<p>[mgm]</p>
<p>HostName = 172.20.86.185</p>
<p>Id = 10</p>
<p>[mysqld]</p>
<p>Id=20</p>
<p>HostName = 172.20.86.185</p>
<h2 id="Step-2-Restart-the-management-server"><a href="#Step-2-Restart-the-management-server" class="headerlink" title="Step 2: Restart the management server"></a>Step 2: Restart the management server</h2><h3 id="Step-2-1停止管理节点"><a href="#Step-2-1停止管理节点" class="headerlink" title="Step 2.1停止管理节点"></a>Step 2.1停止<strong>管理</strong>节点</h3><p>ndb_mgm&gt;<code>**10 STOP**</code></p>
<p>Node 10 has shut down.</p>
<p>Disconnecting to allow Management Server to shutdown</p>
<p>shell&gt;</p>
<h3 id="Step-2-2重新加载配置文件"><a href="#Step-2-2重新加载配置文件" class="headerlink" title="Step 2.2重新加载配置文件"></a>Step 2.2重新加载配置文件</h3><p>shell&gt;<code>**ndb_mgmd -f config.ini --reload**</code></p>
<p>2008-12-08 17:29:23 [MgmSrvr] INFO-- NDB Cluster Management Server.5.1.34-ndb-7.0.7</p>
<p>2008-12-08 17:29:23 [MgmSrvr] INFO–Readingcluster configuration from ‘config.ini’</p>
<h3 id="Step-2-3查看新集群状态"><a href="#Step-2-3查看新集群状态" class="headerlink" title="Step 2.3查看新集群状态"></a>Step 2.3查看新集群状态</h3><p>-- NDB Cluster – Management Client –</p>
<p>ndb_mgm&gt;<code>**SHOW**</code></p>
<p>Connected to Management Server at: 172.20.86.185:1186</p>
<p>Cluster Configuration</p>
<p>---------------------</p>
<p>[ndbd(NDB)]2 node(s)</p>
<p><a href="mailto:id=1@172.20.86.188" target="_blank" rel="noopener">id=1@172.20.86.188</a>(5.1.32-ndb-7.0.5, Nodegroup: 0, Master)</p>
<p><a href="mailto:id=2@172.20.86.189" target="_blank" rel="noopener">id=2@172.20.86.189</a>(5.1.32-ndb-7.0.5, Nodegroup: 0)</p>
<p>id=3 (not connected, accepting connect from 172.20.86.186)</p>
<p>id=4 (not connected, accepting connect from 172.20.86.187)</p>
<p>[ndb_mgmd(MGM)] 1 node(s)</p>
<p>id=10 @172.20.86.185(5.1.32-ndb-7.0.5)</p>
<p>[mysqld(API)]1 node(s)</p>
<p><a href="mailto:id=20@172.20.86.185" target="_blank" rel="noopener">id=20@172.20.86.185</a> (5.1.32-ndb-7.0.5)</p>
<h2 id="Step-3-Perform-a-rolling-restart-of-the-existing-data-nodes-–轮流重新启动连接的数据节点"><a href="#Step-3-Perform-a-rolling-restart-of-the-existing-data-nodes-–轮流重新启动连接的数据节点" class="headerlink" title="Step 3: Perform. a rolling restart of the existing data nodes –轮流重新启动连接的数据节点"></a>Step 3: Perform. a rolling restart of the existing <strong>data</strong> nodes –轮流重新启动连接的数据节点</h2><p>ndb_mgm&gt;<code>**1 RESTART**</code></p>
<p>Node 1: Node shutdown initiated</p>
<p>Node 1: Node shutdown completed, restarting, no start.</p>
<p>Node 1 is being restarted</p>
<p>ndb_mgm&gt; Node 1: Start initiated (version7.0.5)</p>
<p>Node 1: Started (version7.0.5)</p>
<p>ndb_mgm&gt;<code>**2 RESTART**</code></p>
<p>Node 2: Node shutdown initiated</p>
<p>Node 2: Node shutdown completed, restarting, no start.</p>
<p>Node 2 is being restarted</p>
<h2 id="Step-4-Perform-a-rolling-restart-of-all-cluster-API-nodes-–轮流重启sql节点"><a href="#Step-4-Perform-a-rolling-restart-of-all-cluster-API-nodes-–轮流重启sql节点" class="headerlink" title="Step 4: Perform. a rolling restart of all cluster API nodes –轮流重启sql节点"></a>Step 4: Perform. a rolling restart of all cluster API nodes –轮流重启<strong>sql</strong>节点</h2><p>本案仅有一个sql节点</p>
<p>shell&gt;<code>mysqladmin -uroot -p_password_shutdown</code></p>
<p>shell&gt;<code>mysqld_safe &amp;</code></p>
<h2 id="Step-5-Perform-an-initial-start-of-the-new-data-nodes-–初始化新的数据节点"><a href="#Step-5-Perform-an-initial-start-of-the-new-data-nodes-–初始化新的数据节点" class="headerlink" title="Step 5: Perform. an initial start of the new data nodes –初始化新的数据节点"></a>Step 5: Perform. an initial start of the new data nodes –初始化新的数据节点</h2><p>在新增的数据节点上186和187上执行</p>
<p>Shell&gt;ndbmtd –initial</p>
<p>或者</p>
<p>Shell&gt;ndbd –initial</p>
<p>登陆管理节点查看集群状态</p>
<p>Connected to Management Server at: 172.20.86.185:1186</p>
<p>Cluster Configuration</p>
<p>---------------------</p>
<p>[ndbd(NDB)]2 node(s)</p>
<p><a href="mailto:id=1@172.20.86.188" target="_blank" rel="noopener">id=1@172.20.86.188</a>(5.1.32-ndb-7.0.5, Nodegroup: 0, Master)</p>
<p><a href="mailto:id=2@172.20.86.189" target="_blank" rel="noopener">id=2@172.20.86.189</a>(5.1.32-ndb-7.0.5, Nodegroup: 0)</p>
<p><a href="mailto:id=3@172.20.86.186" target="_blank" rel="noopener">id=3@172.20.86.186</a>(5.1.32-ndb-7.0.5,<strong>no nodegroup</strong>)</p>
<p><a href="mailto:id=4@172.20.86.187" target="_blank" rel="noopener">id=4@172.20.86.187</a>(5.1.32-ndb-7.0.5,<strong>no nodegroup</strong>)</p>
<p>[ndb_mgmd(MGM)] 1 node(s)</p>
<p><a href="mailto:id=10@172.20.86.185" target="_blank" rel="noopener">id=10@172.20.86.185</a>(5.1.32-ndb-7.0.5)</p>
<p>[mysqld(API)]2 node(s)</p>
<p><a href="mailto:id=20@172.20.86.185" target="_blank" rel="noopener">id=20@172.20.86.185</a> (5.1.32-ndb-7.0.5)</p>
<h2 id="Step-6-Create-a-new-node-group"><a href="#Step-6-Create-a-new-node-group" class="headerlink" title="Step 6: Create a new node group."></a>Step 6: Create a new node group.</h2><p>ndb_mgm&gt;<code>**CREATE NODEGROUP 3,4**</code></p>
<p>Nodegroup 1 created</p>
<p>ndb_mgm&gt;<code>**SHOW**</code></p>
<p>Connected to Management Server at: 172.20.86.185:1186</p>
<p>Cluster Configuration</p>
<p>---------------------</p>
<p>[ndbd(NDB)]2 node(s)</p>
<p><a href="mailto:id=1@172.20.86.188" target="_blank" rel="noopener">id=1@172.20.86.188</a>(5.1.32-ndb-7.0.5, Nodegroup: 0, Master)</p>
<p><a href="mailto:id=2@172.20.86.189" target="_blank" rel="noopener">id=2@172.20.86.189</a>(5.1.32-ndb-7.0.5, Nodegroup: 0)</p>
<p><a href="mailto:id=3@172.20.86.186" target="_blank" rel="noopener">id=3@172.20.86.186</a> (5.1.32-ndb-7.0.5,<strong>Nodegroup: 1</strong>)</p>
<p><a href="mailto:id=4@172.20.86.187" target="_blank" rel="noopener">id=4@172.20.86.187</a> (5.1.32-ndb-7.0.5,<strong>Nodegroup: 1</strong>)</p>
<p>[ndb_mgmd(MGM)] 1 node(s)</p>
<p><a href="mailto:id=10@172.20.86.185" target="_blank" rel="noopener">id=10@172.20.86.185</a> (5.1.32-ndb-7.0.5)</p>
<p>[mysqld(API)]1 node(s)</p>
<p><a href="mailto:id=20@172.20.86.185" target="_blank" rel="noopener">id=20@172.20.86.185</a> (5.1.32-ndb-7.0.5)</p>
<h2 id="Step-7-Redistribute-cluster-data-–数据的重新分配"><a href="#Step-7-Redistribute-cluster-data-–数据的重新分配" class="headerlink" title="Step 7: Redistribute cluster data. –数据的重新分配"></a>Step 7: Redistribute cluster data. –数据的重新分配</h2><p>对于新增的数据节点一些访问量较高的数据和比较重要的数据需要从新分配。</p>
<p>分发数据命令：</p>
<p>Alter online table ips reorganize partition;</p>
<p>查看数据的分配情况：</p>
<p>ndb_mgm&gt;<code>**ALL REPORT MEMORY**</code></p>
<p>Node 1: Data usage is 5%(177 32K pages of total 3200)</p>
<p>Node 1: Index usage is 0%(108 8K pages of total 12832)</p>
<p>Node 2: Data usage is 5%(177 32K pages of total 3200)</p>
<p>Node 2: Index usage is 0%(108 8K pages of total 12832)</p>
<p><strong>Node 3: Data usage is 0%(0 32K pages of total 3200)</strong></p>
<p><strong><strong>Node 3: Index usage is 0%(0 8K pages of total 12832)</strong></strong></p>
<p><strong><strong>Node 4: Data usage is 0%(0 32K pages of total 3200)</strong></strong></p>
<p><strong><strong>Node 4: Index usage is 0%(0 8K pages of total 12832)</strong></strong></p>
<p><strong>或者</strong></p>
<p><strong>shell&gt;`</strong>ndb_desc -c 192.168.0.10 -d n ips -p<strong>`</strong></p>
<p><strong>-- ips –</strong></p>
<p><strong>Version: 1</strong></p>
<p><strong>Fragment type: 9</strong></p>
<p><strong>K Value: 6</strong></p>
<p><strong>Min load factor: 78</strong></p>
<p><strong>Max load factor: 80</strong></p>
<p><strong>Temporary table: no</strong></p>
<p><strong>Number of attributes: 6</strong></p>
<p><strong>Number of primary keys: 1</strong></p>
<p><strong>Length of frm data: 340</strong></p>
<p><strong>Row Checksum: 1</strong></p>
<p><strong>Row GCI: 1</strong></p>
<p><strong>SingleUserMode: 0</strong></p>
<p><strong>ForceVarPart: 1</strong></p>
<p><strong>FragmentCount: 2</strong></p>
<p><strong>TableStatus: Retrieved</strong></p>
<p><strong>-- Attributes –</strong></p>
<p><strong>id Bigint PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY AUTO_INCR</strong></p>
<p><strong>country_code Char(2;latin1_swedish_ci) NOT NULL AT=FIXED ST=MEMORY</strong></p>
<p><strong>type Char(4;latin1_swedish_ci) NOT NULL AT=FIXED ST=MEMORY</strong></p>
<p><strong>ip_address Varchar(15;latin1_swedish_ci) NOT NULL AT=SHORT_VAR ST=MEMORY</strong></p>
<p><strong>addresses Bigunsigned NULL AT=FIXED ST=MEMORY</strong></p>
<p><strong>date Bigunsigned NULL AT=FIXED ST=MEMORY</strong></p>
<p><strong>-- Indexes –</strong></p>
<p><strong>PRIMARY KEY(id) - UniqueHashIndex</strong></p>
<p><strong>PRIMARY(id) - OrderedIndex</strong></p>
<p><strong><strong>-- Per partition info –</strong></strong></p>
<p><strong><strong>PartitionRow countCommit countFrag fixed memoryFrag varsized memory</strong></strong></p>
<p><strong><strong>026086260861572864557056</strong></strong></p>
<p><strong><strong>126329263291605632557056</strong></strong></p>
<p><strong>NDBT_ProgramExit: 0 - OK</strong></p>
<p><strong>You can cause the data to be redistributed among all of the data nodes by performing, for each<code>NDBCLUSTER</code>table, an<code>ALTER ONLINE TABLE ... REORGANIZE PARTITION</code>statement in the<a href="http://dev.mysql.com/doc/refman/5.1/en/mysql.html" title="4.5.1. mysql — The MySQL Command-Line Tool" target="_blank" rel="noopener"></a></strong>mysql<strong>client. After issuing the statement<code>ALTER ONLINE TABLE ips REORGANIZE PARTITION</code>, you can see using</strong>ndb_desc<strong>that the data for this table is now stored using 4 partitions, as shown here (with the relevant portions of the output in bold type):</strong></p>
<p><strong>shell&gt;`</strong>ndb_desc -c 172.20.86.185 -d n ips -p<strong>`</strong></p>
<p><strong>-- ips –</strong></p>
<p><strong>Version: 16777217</strong></p>
<p><strong>Fragment type: 9</strong></p>
<p><strong>K Value: 6</strong></p>
<p><strong>Min load factor: 78</strong></p>
<p><strong>Max load factor: 80</strong></p>
<p><strong>Temporary table: no</strong></p>
<p><strong>Number of attributes: 6</strong></p>
<p><strong>Number of primary keys: 1</strong></p>
<p><strong>Length of frm data: 341</strong></p>
<p><strong>Row Checksum: 1</strong></p>
<p><strong>Row GCI: 1</strong></p>
<p><strong>SingleUserMode: 0</strong></p>
<p><strong>ForceVarPart: 1</strong></p>
<p><strong>FragmentCount: 4</strong></p>
<p><strong>TableStatus: Retrieved</strong></p>
<p><strong>-- Attributes –</strong></p>
<p><strong>id Bigint PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY AUTO_INCR</strong></p>
<p><strong>country_code Char(2;latin1_swedish_ci) NOT NULL AT=FIXED ST=MEMORY</strong></p>
<p><strong>type Char(4;latin1_swedish_ci) NOT NULL AT=FIXED ST=MEMORY</strong></p>
<p><strong>ip_address Varchar(15;latin1_swedish_ci) NOT NULL AT=SHORT_VAR ST=MEMORY</strong></p>
<p><strong>addresses Bigunsigned NULL AT=FIXED ST=MEMORY</strong></p>
<p><strong>date Bigunsigned NULL AT=FIXED ST=MEMORY</strong></p>
<p><strong>-- Indexes –</strong></p>
<p><strong>PRIMARY KEY(id) - UniqueHashIndex</strong></p>
<p><strong>PRIMARY(id) - OrderedIndex</strong></p>
<p><strong><strong>-- Per partition info –</strong></strong></p>
<p><strong><strong>PartitionRow countCommit countFrag fixed memoryFrag varsized memory</strong></strong></p>
<p><strong><strong>012981522961572864557056</strong></strong></p>
<p><strong><strong>113236525151605632557056</strong></strong></p>
<p><strong><strong>21310513105819200294912</strong></strong></p>
<p><strong><strong>31309313093819200294912</strong></strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/10/understanding-of-the-three-modes-of-access-hybrid-and-trunk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/10/understanding-of-the-three-modes-of-access-hybrid-and-trunk/" itemprop="url">Access、Hybrid和Trunk三种模式的理解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-10T10:45:30+08:00">
                2010-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/默认分类/" itemprop="url" rel="index">
                    <span itemprop="name">默认分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Tag，untag以及交换机的各种端口模式是网络工程技术人员调试交换机时接触最多的概念了，然而笔者发现在实际工作中技术人员往往对这些概念似懂非懂，笔者根据自己的理解再结合一个案例，试图向大家阐明这些概念  </p>
<p>untag就是普通的ethernet报文，普通PC机的网卡是可以识别这样的报文进行通讯；<br>tag报文结构的变化是在源mac地址和目的mac地址之后，加上了4bytes的vlan信息，也就是vlan tag头；一般来说这样的报文普通PC机的网卡是不能识别的  </p>
<p>下图说明了802.1Q封装tag报文帧结构  </p>
<p>带802.1Q的帧是在标准以太网帧上插入了4个字节的标识。其中包含：<br>2个字节的协议标识符（TPID)，当前置0x8100的固定值，表明该帧带有802.1Q的标记信息。<br>2个字节的标记控制信息（TCI），包含了三个域。<br>Priority域，占3bits，表示报文的优先级，取值0到7，7为最高优先级，0为最低优先级。该域被802.1p采用。<br>规范格式指示符（CFI)域，占1bit，0表示规范格式，应用于以太网；1表示非规范格式，应用于Token Ring。<br>VLAN ID域，占12bit，用于标示VLAN的归属。  </p>
<p>以太网端口有三种链路类型：Access、Hybrid和Trunk。<br>Access类型的端口只能属于1个VLAN，一般用于连接计算机的端口；<br>Trunk类型的端口可以允许多个VLAN通过，可以接收和发送多个VLAN的报文，一般用于交换机之间连接的端口；<br>Hybrid类型的端口可以允许多个VLAN通过，可以接收和发送多个VLAN的报文，可以用于交换机之间连接，也可以用于连接用户的计算机。<br>Hybrid端口和Trunk端口在接收数据时，处理方法是一样的，唯一不同之处在于发送数据时：Hybrid端口可以允许多个VLAN的报文发送时不打标签，而Trunk端口只允许缺省VLAN的报文发送时不打标签。  </p>
<p>在这里先要向大家阐明端口的缺省VLAN这个概念<br>Access端口只属于1个VLAN，所以它的缺省VLAN就是它所在的VLAN，不用设置；<br>Hybrid端口和Trunk端口属于多个VLAN，所以需要设置缺省VLAN ID。缺省情况下，Hybrid端口和Trunk端口的缺省VLAN为VLAN 1<br>如果设置了端口的缺省VLAN ID，当端口接收到不带VLAN Tag的报文后，则将报文转发到属于缺省VLAN的端口；当端口发送带有VLAN Tag的报文时，如果该报文的VLAN ID与端口缺省的VLAN ID相同，则系统将去掉报文的VLAN Tag，然后再发送该报文。<br>注：对于华为交换机缺省VLAN被称为“Pvid Vlan”， 对于思科交换机缺省VLAN被称为“Native Vlan”  </p>
<p>交换机接口出入数据处理过程如下：  </p>
<p>Acess端口收报文:<br>收到一个报文,判断是否有VLAN信息：如果没有则打上端口的PVID，并进行交换转发,如果有则直接丢弃（缺省）  </p>
<p>Acess端口发报文：<br>将报文的VLAN信息剥离，直接发送出去  </p>
<p>trunk端口收报文：<br>收到一个报文，判断是否有VLAN信息：如果没有则打上端口的PVID，并进行交换转发，如果有判断该trunk端口是否允许该 VLAN的数据进入：如果可以则转发，否则丢弃  </p>
<p>trunk端口发报文：<br>比较端口的PVID和将要发送报文的VLAN信息，如果两者相等则剥离VLAN信息，再发送，如果不相等则直接发送  </p>
<p>hybrid端口收报文：<br>收到一个报文,判断是否有VLAN信息：如果没有则打上端口的PVID，并进行交换转发，如果有则判断该hybrid端口是否允许该VLAN的数据进入：如果可以则转发，否则丢弃(此时端口上的untag配置是不用考虑的，untag配置只对发送报文时起作用)  </p>
<p>hybrid端口发报文：<br>1、判断该VLAN在本端口的属性（disp interface 即可看到该端口对哪些VLAN是untag， 哪些VLAN是tag）<br>2、如果是untag则剥离VLAN信息，再发送，如果是tag则直接发送  </p>
<p>以下案例可以帮助大家深入理解华为交换机的hybrid端口模式<br>[Switch-Ethernet0/1]int e0/1<br>[Switch-Ethernet0/1]port link-type hybrid<br>[Switch-Ethernet0/1]port hybrid pvid vlan 10<br>[Switch-Ethernet0/1]port hybrid vlan 10 20 untagged<br>[Switch-Ethernet0/1] int e0/2<br>[Switch-Ethernet0/2]port link-type hybrid<br>[Switch-Ethernet0/2]port hybrid pvid vlan 20<br>[Switch-Ethernet0/2]port hybrid vlan 10 20 untagged<br>此时inter e0/1和inter e0/2下的所接的PC是可以互通的，但互通时数据所走的往返vlan是不同的。<br>以下以inter e0/1下的所接的pc1访问inter e0/2下的所接的pc2为例进行说明  </p>
<p>pc1所发出的数据，由inter0/1所在的pvid vlan10封装vlan10的标记后送入交换机，交换机发现inter e0/2允许vlan 10的数据通过，于是数据被转发到inter e0/2上，由于inter e0/2上vlan 10是untagged的，于是交换机此时去除数据包上vlan10的标记，以普通包的形式发给pc2，此时pc1-&gt;p2走的是vlan10  </p>
<p>再来分析pc2给pc1回包的过程，pc2所发出的数据，由inter0/2所在的pvid vlan20封装vlan20的标记后送入交换机，交换机发现inter e0/1允许vlan 20的数据通过，于是数据被转发到inter e0/1上，由于inter e0/1上vlan 20是untagged的，于是交换机此时去除数据包上vlan20的标记，以普通包的形式发给pc1，此时pc2-&gt;pc1走的是vlan20  </p>
<p>＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝  </p>
<p>综上所述，以下列举 Switch收发 Switch对标记的处理 remark<br>Access (接收) Tagged = PVID 不接收 注：部分高端产品可能接收。<br>Access (接收) Tagged =/ PVID 不接收 注：部分高端产品可能接收。<br>Access (接收) Untagged 接收 增加tag＝PVID 从PC  </p>
<p>Access (发送) Tagged = PVID 转发 删除tag<br>Access (发送) Tagged =/ PVID 不转发 不处理<br>Access (发送) Untagged 无此情况 无此情况 无此情况  </p>
<p>Trunk (接收) Tagged = PVID 接收 不修改tag<br>Trunk (接收) Tagged =/ PVID 接收 不修改tag<br>Trunk (接收) Untagged 接收 增加tag＝PVID<br>Trunk (发送) Tagged = PVID If Passing then 转发 删除tag<br>Trunk (发送) Tagged =/ PVID If Passing then 转发 不修改tag<br>Trunk (发送) Untagged 无此情况 无此情况 无此情况（注）  </p>
<p>Hybrid (接收) Tagged = PVID 接收 不修改tag 对端是trunk<br>Hybrid (接收) Tagged =/ PVID 接收 不修改tag 对端是trunk<br>Hybrid (接收) Untagged 接收 增加tag＝PVID 类Trunk<br>Hybrid (发送) Tagged = PVID Tag 和 untag 中列出的vlan可以passing 看Tag项和untag项<br>Hybrid (发送) Tagged =/ PVID Tag 和 untag 中列出的vlan可以passing 看Tag项和untag项<br>Hybrid (发送) Untagged 无此情况 无此情况 无此情况（注）  </p>
<p>另外需要注意的是：  </p>
<p>（1）Trunk端口不能和isolate-user-vlan同时配置；Hybrid端口可以和isolate-user-vlan同时配置。但如果缺 省VLAN是在isolate-user-vlan中建立了映射的VLAN，则不允许修改缺省VLAN ID，只有在解除映射后才能进行修改。  </p>
<p>（2） 本Hybrid端口或Trunk端口的缺省VLAN ID和相连的对端交换机的Hybrid端口或Trunk端口的缺省VLAN ID必须一致，否则报文将不能正确传输。  </p>
<p>access  : 只需记住这八个字“进口打标，出口解标”。<br>trunk：<br>             a.当一个数据帧要从trunk端口发送出去，若交换机发现该以太网帧中tag标记所指的vlan与trunk端口的本地vlan相同，则解标。其余情况一律不解标。<br>             b.当收到一个原始以太网帧（无携带tag时），打标（打上本地vlan的标签）（cisco  ISL不存在解标的情况）<br>hybrid： 则是允许多个vlan不打标。<br>vlan1 成为一个特殊的vlan是因为第二层设备需要一个默认的vlan作为他们端口的归属，包括他们的管理端口。 native vlan的作用是给协议报文提供一个专用的vlan。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/12/09/iowait-s-high-handling-methods/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/12/09/iowait-s-high-handling-methods/" itemprop="url">IOWait高的一些处理方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2010-12-09T11:28:15+08:00">
                2010-12-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>抓哪个进程干坏事前要先停掉syslog<br>/etc/init.d/rsyslog stop<br>echo 1 &gt; /proc/sys/vm/block_dump<br>dmesg | egrep “READ|WRITE|dirtied” | egrep -o ‘([a-zA-Z]*)’ | sort | uniq -c | sort -rn | head  </p>
<p>#类似如下数据  </p>
<p>#1423 kjournald  </p>
<p>#1075 pdflush  </p>
<p>#209 indexer  </p>
<p>#3 cronolog  </p>
<p>#1 rnald  </p>
<p>#1 mysqld  </p>
<p>#不要忘记在抓完之后关掉block_dump和启动syslog<br>echo 0 &gt; /proc/sys/vm/block_dump<br>/etc/init.d/rsyslog start</p>
<p>或者dmesg | awk  ‘/(READ|WRITE|dirtied)/ {process[$1]++} END {for (x in process) print process[x],x}’|sort -nr|awk ‘{print $2 “ “$1}’|head -n 10</p>
<p>查看进程状态<br>ps -eo pid,user,wchan=WIDE-WCHAN-COLUMN -o s,cmd|awk ‘ $4 ~ /D/ {print $0}’<br>lsof -p $pid</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5"
                alt="haitian" />
            
              <p class="site-author-name" itemprop="name">haitian</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">277</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">163</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">haitian</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
