<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/12/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/12/"/>





  <title>Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/08/linux-upd-packet-size-limits/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/08/linux-upd-packet-size-limits/" itemprop="url">Linux UPD数据包大小限制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-08T12:21:02+08:00">
                2010-11-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天拿起来了以前一个写的程序，因为要上线了，所以同事进行了一次压力测试，经过测试，部分发送的UPD数据包被抛弃了，只好埋头处理了。<br>　　基本程序是这样的，建立UPD服务器用来接收数据包，创建另一个线程处理数据，完成逻辑需求，刚开始我是用一个全局字符串保存数据的，每次只能接收到61个数据包，以后的全被抛弃了，起初以为是PYTHON的字符串导致的结果，所以又将字符串转换为列表，效果依然一样，因为PYTHON提供了QUEUE的模块，所以又将列表转换为队列处理，终于超过61个啦，这个兴奋啊，有句话说的好，事情往往不是那么简单的，查询了日志，发现中间莫名其妙的丢掉了N多数据包，发送的值越大，丢包越严重。<br>　　第二天经过G，<a href="http://www.29west.com/docs/THPM/udp-buffer-sizing.html" target="_blank" rel="noopener">找到了</a>，期间详细的说明了怎样检测UDP丢包和改变UDP缓存大小，所以检测了我的小LINUX上的设置情况 sysctl -a | grep net.core，数据显示是128K，经过适当放大以下两个参数<br>　　net.core.rmem_default<br>　　net.core.rmem_max<br>　　在经过测试，果然丢包的问题解决了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/08/wget-retry-times-and-timeouts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/08/wget-retry-times-and-timeouts/" itemprop="url">wget 重试次数和超时时间</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-08T10:01:03+08:00">
                2010-11-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近服务有问题，内存溢出，但服务的代码已经不在，无法让开发进行优化，前端进行了nginx负载，后端进行wget获取URL，失败时重启服务，但当服务出现问题时，发现重启没有自动重启，查看日志后发现wget一直进行重试操作，所以修改如下，</p>
<p>查看wget参数如下：</p>
<p>-t     设置重试次数。当连接中断（或超时）时，wget将试图重新连接。如果指<br>    定-t0，则重试次数设为无穷多。</p>
<p>-T,–timeout=SECONDS 设置超时时间</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/05/centos5-3-when-using-hal-device/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/05/centos5-3-when-using-hal-device/" itemprop="url">使用hal-device时的报错centos5.3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-05T18:36:49+08:00">
                2010-11-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[root@T61 dbus]# hal-device<br>error: dbus_bus_get: org.freedesktop.DBus.Error.NoServer: Failed to connect to socket /var/run/dbus/system_bus_socket: Connection refused</p>
<p>这是因为dbus服务没有启动，启动dbus服务/etc/init.d/messagebus</p>
<p>又报下面的错误</p>
<p>[root@T61 dbus]# hal-device<br>error: libhal_ctx_init: (null): (null)<br>hal-device.c 144 : INFO: called LIBHAL_FREE_DBUS_ERROR but dbusError was not set.</p>
<p>报这个错，居然是因为hal的服务haldaemon没有启动。</p>
<p>/etc/rc.d/init.d/haldaemon start 解决</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/05/tomcat-to-shut-down-the-cookies/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/05/tomcat-to-shut-down-the-cookies/" itemprop="url">tomcat关闭cookies</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-05T14:41:16+08:00">
                2010-11-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/默认分类/" itemprop="url" rel="index">
                    <span itemprop="name">默认分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Tomcat context.xml 配置文件中 做如下设置 <context cookies="false"></context></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/05/the-distribution-mode-and-equipment-state-of-nginx-load-balancing-are-discussed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/05/the-distribution-mode-and-equipment-state-of-nginx-load-balancing-are-discussed/" itemprop="url">浅谈Nginx负载均衡的分配方式和设备状态</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-05T13:58:37+08:00">
                2010-11-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/默认分类/" itemprop="url" rel="index">
                    <span itemprop="name">默认分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Nginx作为高并发、高性能的HTTP服务器已经被大多开发者所使用，这里简单讲一下Nginx的负载均衡的分配方式和设备状态。</p>
<p>Nginx的upstream目前支持4种方式的分配</p>
<p>(1)轮询（默认）</p>
<p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</p>
<p>(2)weight</p>
<p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p>
<p>(3)ip_hash</p>
<p>每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。</p>
<p>(4)fair（第三方）</p>
<p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>
<p>(5)、url_hash（第三方）</p>
<p>每个设备的状态设置为：</p>
<p>1.down：表示单前的server暂时不参与负载。</p>
<p>2.weight：默认为1.weight越大，负载的权重就越大。</p>
<p>3.max_fails：允许请求失败的次数默认为1.当超过最大次数时，返回proxy_next_upstream 模块定义的错误。</p>
<p>4.fail_timeout：max_fails次失败后，暂停的时间。</p>
<p>5.backup：其它所有的非backup机器down或者忙的时候，请求backup机器。所以这台机器压力会最轻。</p>
<p>复制代码Nginx支持同时设置多组的负载均衡，用来给不用的server来使用。</p>
<p>实例：</p>
<p>upstream wapgate{  </p>
<p>#ip_hash;<br>server 192.168.169.43:11304    ;<br>server 192.168.164.37:11302   ;  </p>
<p>#hash $http_sky_real_ip;<br>hash_again 3;<br>}</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/04/the-parameters-of-the-sar-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/04/the-parameters-of-the-sar-command/" itemprop="url">sar 命令的参数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-04T11:34:03+08:00">
                2010-11-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>根据Linux中的sar命令，总结了一下sar命令的常用参数</p>
<p>Sar相关环境：</p>
<p>S_TIME_FORMAT：If this variable exists and its value is ISO then the current locale will be ignored when printing the date in the report header. The sar command will use the ISO 8601 format (YYYY-MM- DD) instead.</p>
<p>Sar能工作，/proc目录必须被mount上来</p>
<p>CPU</p>
<p>-u</p>
<p>-P</p>
<p>内存</p>
<p>-r</p>
<p>-R</p>
<p>Block device情况</p>
<p>-d</p>
<p>I/O</p>
<p>-b</p>
<p>页交换情况</p>
<p>-B</p>
<p>进程</p>
<p>-c</p>
<p>网络</p>
<p>-n</p>
<p>机器负载</p>
<p>-q</p>
<p>Swap</p>
<p>-W</p>
<p>全部的信息</p>
<p>-A</p>
<p>CPU使用率 – 缺省</p>
<p>Report CPU utilization</p>
<p>-u</p>
<p>%user： Percentage of CPU utilization that occurred while exe cuting at the user level (application).</p>
<p>%nice：at the user level with nice priority</p>
<p>%system：at the system level (kernel).</p>
<p>%iowait：Percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request</p>
<p>%idle： Percentage of time that the CPU or CPUs were idle and the system did not have an outstanding disk I/O request</p>
<p>CPU情况</p>
<p>-P cpu | ALL</p>
<p>统计单个或多个cpu的情况</p>
<p>ALL：再加上整体统计情况</p>
<p>-u 和–I SUM 2个参数跟着-P有意义。</p>
<p>内存使用率</p>
<p>Report memory and swap space utilization statistics</p>
<p>-r</p>
<p>所有的数量单位： kbytes</p>
<p>Kbmemfree、Kbmemused、%memused：</p>
<p>内存空闲、使用了，使用的%</p>
<p>Kbbuffers：内核当作buffer使用的内存</p>
<p>Kbcached:：内核当作cache data使用的内存</p>
<p>Kbswpfree、Kbswpused、%swpused</p>
<p>Swap使用的3个值</p>
<p>Kbswpcad：缓存的swap空间。这个意思是：内存被swap out,又立即swap back in,但是还存在swap中，（如果memory需要，memory不需要再次swap out了，它在swap已经存在，节省了I/O）</p>
<p>内存使用统计</p>
<p>Report memory statistics</p>
<p>-R</p>
<p>frmpg/s：系统释放的内存页数量，如果是负数表示被系统分配的数量。内存页时4k或8k和系统架构有关。</p>
<p>bufpg/s：系统用作buffer的增量内存页</p>
<p>campg/s：系统用作cache的增量内存页</p>
<p>I/O和传输统计</p>
<p>I/O and tranfer statistics</p>
<p>-b</p>
<p>只在Kernal2.5以前的版本中才有效</p>
<p>Tps：物理磁盘每秒总的传输量。多个逻辑的请求可能被合并成一个单独的磁盘请求。</p>
<p>Rtps：读的请求</p>
<p>Wtps：写的请求</p>
<p>Bread/s：每秒从磁盘读的块数</p>
<p>Wread/s：每秒写的块数</p>
<p>页的统计消息</p>
<p>Paging statistics</p>
<p>-B</p>
<p>Pgpgin/s: 每秒磁盘page in的数量（kbytes）</p>
<p>Pgpgout/s：每秒磁盘page out的量（kbytes）</p>
<p>Fault/s：系统每秒page faults（major+minor）的数量（2.5以上kernal）</p>
<p>majflt/s：系统每秒产生的major faults数量（2.5以上kernel）</p>
<p>进程</p>
<p>Process creation</p>
<p>-c</p>
<p>Proc/s：每秒产生的进程数量</p>
<p>Block device性能</p>
<p>-d</p>
<p>2.4或以上版本有</p>
<p>Devm-n: m:device的major number</p>
<p>n: device的 minor number(kernal 2.5)</p>
<p>tps:　设备的每秒传输量</p>
<p>rd_sec/s:设备的读的扇区数量（512k/sector）</p>
<p>wr_sec/s : 设备写的扇区数量（512k/sector）</p>
<p>采用文件</p>
<p>-f ： 从。。读</p>
<p>-o： 写入。。。</p>
<p>从文件中获取数据（由-o产生的文件）</p>
<p>缺省值是current daily data file（/var/log/sa/sadd）</p>
<p>-f排斥-o参数</p>
<p>改变间隔时间</p>
<p>-i interval</p>
<p>单位是秒</p>
<p>网络情况</p>
<p>-n</p>
<p>-n DEV | EDEV | SOCK | FULL</p>
<p>DEV参数：</p>
<p>Network devices 的统计信息被报告</p>
<p>IFACE：设备名字</p>
<p>rxpck/s：每秒收到的包（package）</p>
<p>txpck/s：每秒传输的包</p>
<p>rxbyt/s：每秒收到的字节</p>
<p>txbyt/s：每秒传输的字节</p>
<p>rxcmp/s：每秒收到的压缩包（如cslip..）</p>
<p>txcmp/s:</p>
<p>rxmcst/s: 每秒收到的广播包</p>
<p>EDEV：</p>
<p>错误的统计信息</p>
<p>rxerr/s， txerr/s</p>
<p>coll/s： 传输过程中遇到的冲突包</p>
<p>rxdrop/s， txdrop/s：由于缺少Linux缓存区，被丢弃的接收/传输包</p>
<p>txcarr/s： 传输包时候遇到的carrier-errors数量</p>
<p>rxfram/s：接收frame对列错误数量</p>
<p>rxfifo/s：接收FIFO overrun错误数量</p>
<p>txfifo/s：传输的FIFO overrun错误数量</p>
<p>SOCK：</p>
<p>使用中的socket统计</p>
<p>Totsck： 使用中的socket</p>
<p>Tcpsck： tcp socket</p>
<p>Udpsck：</p>
<p>Rawsck：</p>
<p>ip-frag： Number of IP fragments currently in use.</p>
<p>机器负载</p>
<p>Report queue length and load averages</p>
<p>-q</p>
<p>runq-sz：运行的队列长度（number of processes waiting for run time）</p>
<p>plist-sz： （Number of processes in the process list）</p>
<p>ldavg-1、ldavg-5、ldavg-15：</p>
<p>1、5、15分钟平均负载</p>
<p>文件</p>
<p>Report status of inode, file and other kernel tables</p>
<p>-v</p>
<p>Dentunusd：Number of unused cache entries in the directory cache<br>file-sz：Number of used file handles</p>
<p>inode-sz：Number of used file handles</p>
<p>super-sz、%super-sz： Number of super block handlers allocated by the kerne。(regard to the maximum number of super block handlers that Linux can allocate)</p>
<p>dquot-sz、%dquot-sz：Number of allocated disk quota entries (regard to the maximum number of cached disk quota entries that can be allocated)</p>
<p>rtsig-sz、%rtsig-sz：Number of queued RT signals.（regard to the maxi mum number of RT signals that can be queued）</p>
<p>Report system switching activity</p>
<p>-w</p>
<p>cswch/s：Total number of context switches per second.</p>
<p>Swap：</p>
<p>Report swapping statistics</p>
<p>-W</p>
<p>pswpin/s： Total number of swap pages the system brought in per second</p>
<p>pswpout/s：Total number of swap pages the system brought out per second</p>
<p>Process相关</p>
<p>-x</p>
<p>-X</p>
<p>改变格式</p>
<p>-h</p>
<p>-H</p>
<p>设定时间</p>
<p>-e hh:mm:ss：结束时间</p>
<p>-s 开始时间</p>
<p>设置报告的截止时间。缺省的截止时间是18:00:00, 给出的时间必须24小时制。</p>
<p>这个参数只有当数据从文件中读写时候才有效（-f / -o 参数）。</p>
<p>如果同时使用-h参数，给出的时间是UTC时间</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/04/use-sa-and-sar-for-system-monitoring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/04/use-sa-and-sar-for-system-monitoring/" itemprop="url">使用SA和SAR进行系统监视</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-04T11:33:04+08:00">
                2010-11-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先需要安装一个包</p>
<h1 id="rpm-qa-sysstat"><a href="#rpm-qa-sysstat" class="headerlink" title="rpm -qa sysstat"></a>rpm -qa sysstat</h1><p>sysstat-7.0.2-3.el5</p>
<p>这个包安装了一些很有用的文件</p>
<h1 id="rpm-ql-sysstat"><a href="#rpm-ql-sysstat" class="headerlink" title="rpm -ql sysstat"></a>rpm -ql sysstat</h1><p>/etc/cron.d/sysstat</p>
<p>/etc/rc.d/init.d/sysstat</p>
<p>/etc/sysconfig/sysstat</p>
<p>/etc/sysconfig/sysstat.ioconf</p>
<p>/usr/bin/iostat</p>
<p>/usr/bin/mpstat</p>
<p>/usr/bin/sadf</p>
<p>/usr/bin/sar</p>
<p>/usr/lib/sa</p>
<p>/usr/lib/sa/sa1</p>
<p>/usr/lib/sa/sa2</p>
<p>/usr/lib/sa/sadc</p>
<p>……</p>
<p>/var/log/sa</p>
<p>要启动SAR，必须通过cron工具以周期性的间隔启动。</p>
<p>安装sysstat包后，默认创建一个/etc/cron.d/sysstat文件，其默认内容为：</p>
<h1 id="run-system-activity-accounting-tool-every-10-minutes"><a href="#run-system-activity-accounting-tool-every-10-minutes" class="headerlink" title="run system activity accounting tool every 10 minutes"></a>run system activity accounting tool every 10 minutes</h1><p><em>/10 </em> <em> </em> * root /usr/lib/sa/sa1 1 1</p>
<h1 id="generate-a-daily-summary-of-process-accounting-at-23-53"><a href="#generate-a-daily-summary-of-process-accounting-at-23-53" class="headerlink" title="generate a daily summary of process accounting at 23:53"></a>generate a daily summary of process accounting at 23:53</h1><p>53 23 <em> </em> * root /usr/lib/sa/sa2 -A</p>
<p>这里用到了两个命令</p>
<p>/usr/lib/sa/sa1</p>
<p>/usr/lib/sa/sa2</p>
<p>sa1：是调用sadc（二进制文件），将数据收集到二进制日志文件的一个Shell脚本。sa1命令还确保每天使用不同的文件。每隔十分钟运行一次该命令，最好不要改这个值，这是对一般系统折中的值。二进制日志文件存放在/var/log/sa/目录下，命名为sa${DATE}。</p>
<p>sa2：是将当日二进制日志文件中所有的数据转储到文本文件（sar）的另一个Shell脚本，然后它将清除七天之前的所有日志文件。参数-A指定了从二进制文件中提取哪些数据转储到文本文件中。转储的文件存放在/var/log/sa/目录下，命名为sar${DATE}。</p>
<p>这两个命令要配合着使用。</p>
<p>（强烈建议看一下这两个命令的脚本）</p>
<p>查看一下/usr/lib/sa/sa1脚本，里面执行这样一句命令：</p>
<p>/usr/lib/sa/sadc -F -L 1 1 -</p>
<p>-F：强制指定一个储存文件，如果文件已存在，就将其转换成sa的二进制文件形式。</p>
<p>-L：给sa文件加互斥锁，不能让两个sadc进程同时写一个sa文件。</p>
<p>跟据sa1脚本中的命令，我们也可以手动的创建sa二进制文件，使用/usr/lib/sa/sadc命令，</p>
<h1 id="usr-lib-sa-sadc-1-10-tmp-jaylin-sa"><a href="#usr-lib-sa-sadc-1-10-tmp-jaylin-sa" class="headerlink" title="/usr/lib/sa/sadc 1 10 /tmp/jaylin_sa"></a>/usr/lib/sa/sadc 1 10 /tmp/jaylin_sa</h1><p>上述命令的作用是：每隔1s写一条记录，写10条，存放到二进制文件/tmp/jaylin_sa中。</p>
<p>查看一下/usr/lib/sa/sa2脚本，里面执行这样一句命令：</p>
<p>/usr/bin/sar -A -f /var/log/sa/sa${DATE} &gt; /var/log/sa/sar${DATE}</p>
<p>-A：列出所有存储在/var/log/sa/sa${DATE}里的统计信息。</p>
<p>-f：指定将要转储的sa文件，默认的参数值为/var/log/sa/sa${DATE}。</p>
<p>根据sa2脚本中的命令，我们也可以手动将sa文件（二进制）转储到sar文件（ASCII文本）中，使用/usr/bin/sar命令，</p>
<h1 id="usr-bin-sar-A-f-tmp-jaylin-sa-gt-tmp-jaylin-sar"><a href="#usr-bin-sar-A-f-tmp-jaylin-sa-gt-tmp-jaylin-sar" class="headerlink" title="/usr/bin/sar -A -f /tmp/jaylin_sa&gt; /tmp/jaylin_sar"></a>/usr/bin/sar -A -f /tmp/jaylin_sa&gt; /tmp/jaylin_sar</h1><p>我们可以通过cat等命令查看sar文件的内容。但是我们也可以通过sar命令读取sa的二进制文件。</p>
<h1 id="sar"><a href="#sar" class="headerlink" title="sar"></a>sar</h1><p>03:00:01 PM     CPU     %user     %nice   %system   %iowait    %steal    %idle</p>
<p>03:10:01 PM       all      1.02      0.00      2.33      0.39      0.00     96.25</p>
<p>03:20:01 PM       all      1.85      0.00      3.29      0.32      0.00     94.54</p>
<p>03:30:02 PM       all      1.63      0.06      3.81      2.05      0.00     92.45</p>
<p>03:40:02 PM       all      9.31      0.00      8.10      3.39      0.00     79.20</p>
<p>03:50:01 PM       all      8.64      0.00      7.73      2.27      0.00     81.36</p>
<p>04:00:01 PM       all      0.84      0.00      2.12      1.81      0.00     95.23</p>
<p>Average:          all      3.88      0.01      4.56      1.71      0.00     89.84</p>
<p>其中：</p>
<p>%user：CPU花费在用户进程（如应用程序、Shell脚本或该用户进行的交互）上的时间的百分比。</p>
<p>%nice：CPU用来执行有用户级别优先级别的任务的时间的百分比。</p>
<p>%system：CPU用来执行核心任务的时间的百分比。</p>
<p>%iowait：CPU等待块设备输入或输出的时间的百分比。</p>
<p>%steal：CPU等待管理程序（hypervisor）处理其他任务的时间的百分比。</p>
<p>%idle：CPU未进行任何有用操作的时间的百分比。</p>
<p>最后一行是所有数据的平均值。然而，因为大多数系统都会在忙时间段后经历空闲时间段，所以平均值并不能反映完整的情况。</p>
<p>其他度量参数：</p>
<p>-b：显示了缓冲区信息和使用缓冲区与必须写磁盘的比率。</p>
<p>-c：显示了系统调用分解为一些常用的调用，如fork()、exec()、read()和write()。高进程 创建会导致较差的性能，并且这是可能需要将一些应用程序转移到其他计算机的信号。</p>
<p>-p 和 -w：显示了分页（交换）活动。高分页操作是内存缺乏的信号。特别地，-w 选项 显示了进程切换的次数：高的数值表示计算机上运行的内容过多，该计算机在切换任务 上花费了比实际工作更多的时间。</p>
<p>-q：显示了运行队列的大小，它与当时的平均负载相同。</p>
<p>-r：显示了一段时间的可用内存和交换空间。</p>
<p>它们显示每一列的含义请查看sar的man page。</p>
<p>我们也可以查看指定的某一时间段内的记录</p>
<p>-f：指定要读取的sa文件。</p>
<p>-s：开始的时间。注意，-s不是包含性的，所以必须从所选择的开始时间减去十分钟。</p>
<p>-e：结束的时间。</p>
<p>例如：</p>
<h1 id="sar-f-var-log-sa-sa12-s-14-50-00-e-15-30-00"><a href="#sar-f-var-log-sa-sa12-s-14-50-00-e-15-30-00" class="headerlink" title="# sar -f /var/log/sa/sa12 -s 14:50:00 -e 15:30:00"></a># sar -f /var/log/sa/sa12 -s 14:50:00 -e 15:30:00</h1><p>03:00:01 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle</p>
<p>03:10:01 PM       all      1.02      0.00      2.33      0.39      0.00     96.25</p>
<p>03:20:01 PM       all      1.85      0.00      3.29      0.32      0.00     94.54</p>
<p>Average:          all      1.44      0.00      2.81      0.36      0.00     95.40</p>
<p>上述命令查看本月12日，15:00—15:30之间的记录。</p>
<p>下面介绍一个第三方工具Ksar</p>
<p>这个工具可以将sar文件装换成图形，便于查看内存等数据的变化情况。</p>
<p>将下载的kSar-5.0.6.zip解压，解压后生成的目录下，有一个run.sh脚本。给其增加可执行权限。执行脚本，会出现一个图形界面：</p>
<p>将存在的sar文件导入工具，就可以看到根据sar文件记录生成的图形。</p>
<p>注意，如果是手动将sa文件转储到sar文件中，执行sar命令时要加LANG=C，即：</p>
<h1 id="LANG-C-usr-bin-sar-A-f-tmp-jaylin-sa-gt-tmp-jaylin-sar"><a href="#LANG-C-usr-bin-sar-A-f-tmp-jaylin-sa-gt-tmp-jaylin-sar" class="headerlink" title="LANG=C /usr/bin/sar -A -f /tmp/jaylin_sa&gt; /tmp/jaylin_sar"></a>LANG=C /usr/bin/sar -A -f /tmp/jaylin_sa&gt; /tmp/jaylin_sar</h1><p>不加LANG=C，sar文件显示的时间为12小时制；加LANG=C之后，sar文件显示的时间为24小时制。Ksar工具只能识别24小时制的sar文件，所以切记执行转储时要加此环境变量。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/04/linux-ssh-call-time-maintained/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/04/linux-ssh-call-time-maintained/" itemprop="url">linux ssh通话时间保持</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-04T11:24:03+08:00">
                2010-11-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>打开 /etc/ssh/sshd_config 文件，找到一个参数为 ClientAliveCountMax，它是设定用户端的 SSH 连线闲置多长时间后自动终止连线的数值，单位为分钟。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/02/the-actual-deployment-case-of-the-smart-dns-bind-dlz-mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/02/the-actual-deployment-case-of-the-smart-dns-bind-dlz-mysql/" itemprop="url">智能DNS(Bind DLZ MYSQL )实际部署案例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-02T09:22:57+08:00">
                2010-11-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/默认分类/" itemprop="url" rel="index">
                    <span itemprop="name">默认分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>XX网NS服务器为FreeBSD下的Bind master/slave ,起初因为访问量不太大，这个架构完全可以胜任，但是随着域名的增加，维护zone文件变得越来越复杂，一旦书写有误，会造成Bind无法解析域名。所以，特此部署了Bind DLZ Mysql，经过一个月的上线测试，发现其负载很小，每秒5qps。不存在mysql time out问题，因为mysql每时每刻都在查询.在这里感谢老曹的鼎力相助！  </p>
<p>目录</p>
<p>一、相关术语简介</p>
<p>二、智能DNS系统服务规划</p>
<p>三、MYSQLReplication及添加GoogleTCMALLOC库降低系统负载</p>
<p>四、安装配置Bind-DLZ 及相关脚本</p>
<p>五、测试Bind-DLZ相关总结</p>
<p>一相关术语简介：<br>1、智能DNS（Bind-view）：<br>智能DNS的原理很简单：在用户解析一个域名的时候，判断一下用户的IP，然后跟DNS服务器内部的IP表匹配一下，看看用户是电信还是网通用户，然后给用户返回对应的IP地址。目前的域名服务运营商不提供智能DNS服务，所以必须自行架设DNS服务或者使用网上免费的智能DNS服务，如DNSPOD.<br>2．Bind-DLZ<br>Bind-DLZ主页：<a href="http://bind-dlz.sourceforge.net/" target="_blank" rel="noopener">http://bind-dlz.sourceforge.net/</a><br>DLZ(Dynamically Loadable Zones)与传统的BIND9不同，BIND的不足之处：<br>* BIND从文本文件中获取数据，这样容易因为编辑错误出现问题。<br>* BIND需要将数据加载到内存中，如果域或者记录较多，会消耗大量的内存。<br>* BIND启动时解析Zone文件，对于一个记录较多的DNS来说，会耽误更多的时间。<br>* 如果近修改一条记录，那么要重新加载或者重启BIND才能生效，那么需要时间，可能会影响客户端查询。<br>而Bind-dlz 即将帮你解决这些问题, 对Zone文件操作也更方便了，直接对数据库操作,可以很方<br>便扩充及开发管理程序。  </p>
<p>二、智能DNS系统服务规划</p>
<p>1、NameServer服务器注册(到新网或者万网后台添加)<br>ns1.soshandong.com  192.19.13.15<br>ns2.soshandong.com  192.19.11.3  </p>
<p>NS1是master ，NS2是slave。两者数据通过mysql来同步。  </p>
<p>2、测试NS记录是否生效</p>
<p>#digns <a href="http://www.soshandong.com/" target="_blank" rel="noopener">www.soshandong.com</a></p>
<p>#dig<a href="http://www.soshandong.com/" target="_blank" rel="noopener">www.soshandong.com</a>+trace</p>
<p>3、Bind-View规划<br><a href="http://www.soshandong.com" target="_blank" rel="noopener">www.soshandong.com</a> 网通 (CNC)  124.133.11.78<br><a href="http://www.soshandong.com/" target="_blank" rel="noopener">www.soshandong.com</a> 电信(TELECOM) 58.56.11.153<br><a href="http://www.soshandong.com" target="_blank" rel="noopener">www.soshandong.com</a> 移动(ANY) 120.192.11.13  </p>
<p>三、MYSQLReplication在Ubuntu上的安装</p>
<p>Ubuntu上安装Mysql 5.1.51</p>
<p>因新安装的Ubuntu没有zlib-dev库和ncurses，需要执行apt-get 来安装他们  </p>
<p>#apt-get install zlib1g-dev ncurses</p>
<p>首先下载mysql-5.1.51.tar.gz，并解压.</p>
<p>#cd mysql-*</p>
<p>#sh mysql.sh</p>
<p>脚本执行完毕后，将my.cnf放到/etc下  </p>
<p># mv my.cnf /etc/</p>
<p>默认脚本会启动mysql，如果报错，会在数据库目录里有错误日志。</p>
<p>Mysql replication配置</p>
<p>1、Mysql安全设置  </p>
<ul>
<li>用mysqladmin命令来改root用户口令＃ mysqladmin -uroot password linuxtone.org//设置MySQL管理操作用户root的密码为52netseek  </li>
<li>用setpassword修改口令：<br>mysql&gt; set password for root@localhost=password(‘linuxtone.org);  </li>
<li>直接修改user表的root用户口令<br>mysql&gt; use mysql;<br>mysql&gt; update user set password=password(‘linuxtone.org’) where user=’root’;<br>mysql&gt; flush privileges;<br>2.删除默认的数据库和用户我们的数据库是在本地，并且也只需要本地的php脚本对mysql进行读取，所以很多用户不需要。m<br>ysql初始化后会自动生成空用户和test库，这会对数据库构成威胁，我们全部删除。我们使用mysql客户端程序连接到本地的mysql服务器后出现如下提示：<br>mysql&gt; drop database test;<br>mysql&gt; use mysql;<br>mysql&gt; delete from db;<br>mysql&gt; delete from user where not(host=”localhost” anduser=”root”);<br>mysql&gt; flush privileges;<br>Mysql replication设置<br>3、Master 机器设置权限，赋予Slave机器FILE及Replication Slave权利，并打包要同步的数据库结构。<br>Master#./mysql –u root –plinuxtone.org<br>Enter password:<br>Welcome to the MySQL monitor. Commands end with ; or \g.<br>Your MySQL connection id is 2 to server version: 5.1.51<br>Type ‘help;’or ‘\h’ for help. Type ‘\c’ to clear the buffer.<br>mysql&gt; GRANTFILE ON<em>.</em> TO <a href="mailto:slaverep@172.19.1.3" target="_blank" rel="noopener">slaverep@172.19.1.3</a> IDENTIFIEDBY ‘slaverep’;<br>mysql&gt;GRANT REPLICATION SLAVE ON <em>.</em> TO <a href="mailto:slaverep@172.19.1.3%20IDENTIFIED" target="_blank" rel="noopener">slaverep@172.19.1.3 IDENTIFIED</a>BY ‘linuxtone.org’;<br>mysql&gt;Flushprivilege;<br>赋予192.19.11.3也就是Slave 机器有File权限, 这个5.1.51版对replication的权限好像做了调整，只赋予Slave机器有File权限还不行，还要给它REPLICATION SLAVE的权限才可以。<br>Master 导入CDN。Sql文件建立CDN数据结构<br>#mysql–uroot –plinuxtone.org<br>Mysql&gt;create database cdn;<br>Mysql&gt;\q<br>#mysql<br>cdn –uroot –plinuxtone.org &lt;cdn.sql #cdn.sql位置<br>这样master 就有了CDN库的数据结构。<br>Slave一样。这样不再重复<br>2设置主服务器Master的my.cnf，启动Mysql服务<br>Master# vi/etc/my.cnf<br>在[mysqld]添加或修改以下的<br>[mysqld]<br>log-bin = /home/data/mysql/data/binlog/binlog#打开logbin选项以能写到slave的 I/O线程;<br>server-id=1 #表示是本机的序号为1,一般来讲就是master的意思.<br>binlog-do-db= cdn #表示同步cdn数据库;<br>PS:提供的My。Cnf 比较详细。<br>然后把Master主服务器的Mysql重启。<br>Master# servicemysqld restart  </li>
</ul>
<p>4、修改Slave服务器的my.cnf</p>
<p>Slave# vi/etc/my.cnf<br>在[mysqld]添加或修改以下的<br>master-host=192.19.13.15<br>master-user=slaverep<br>master-password=linuxtone.org<br>master-port=3306<br>server-id=10<br>master-connect-retry=60<br>replicate-do-db=cdn [要更新的数据库]<br>log-slave-updates<br>5、删除Slave端数据库目录中的master.info<br>Slave# rm -fmaster.info<br>6、重启动Slave的slave start。<br>Slave#servicemysqld restart<br>7、测试先检测两个Mysql数据库中的cdn是否正常。正常情况应该是Master和Slave 中的Mysql 都有相同的cdn 数据库，并且里面的数据都一样。然后测试replication 功能是否起用。在Master中的reptest数据库添加一笔数据：<br>Master#mysql –u root -p<br>Enter password:<br>Welcome to the MySQL monitor. Commands end with ; or \g.<br>Your MySQL connection id is 12 to server version: 5.1.51<br>Type ‘help;’or ‘\h’ for help. Type ‘\c’ to clear the buffer.<br>mysql&gt;use cdn;<br>Database changed<br>mysql&gt; INSERT INTO rep_table VALUES (‘test1’, ‘4321’, ‘T’,24);<br>Query OK, 1 row affect ed (0.00 sec)<br>mysql&gt;<br>然后查看Slave机器的reptest数据库：<br>Slave#mysql–u root –p<br>Enterpassword:<br>Welcome to the MySQL monitor. Commands end with ; or \g.<br>Your MySQL connection id is 12 to server version: 5.1.49<br>Type ‘help;’or ‘\h’ for help. Type ‘\c’ to clear the buffer.<br>mysql&gt;use cdn;<br>Database changed<br>mysql&gt;select * from reptable;;<br>+——+——+——+——+<br>| id | name| sex | age |<br>+——+——+——+——+<br>| test1|4321 | T | 24 |<br>+——+——+——+——+<br>1 row in set(0.00 sec)  </p>
<p>为mysql 添加TCMalloc库降低系统负载</p>
<p>TCMalloc（Thread-CachingMalloc）是google开发的开源工具──“<a href="http://code.google.com/p/google-perftools/" target="_blank" rel="noopener">google-perftools</a>”中的成员。与标准的glibc库的malloc相比，TCMalloc在内存的分配上效率和速度要高得多，可以在很大程度上提高MySQL服务器在高并发情况下的性能，降低系统负载。<br>1、64位操作系统请先安装libunwind库，32位操作系统不要安装。libunwind库为基于64位CPU和操作系统的程序提供了基本的堆栈辗转开解功能，其中包括用于输出堆栈跟踪的API、用于以编程方式辗转开解堆栈的API以及支持C++异常处理机制的API。  </p>
<p>wget <a href="http://download.savannah.gnu.org/releases/libunwind/libunwind-0.99.tar.gz" target="_blank" rel="noopener">http://download.savannah.gnu.org/releases/libunwind/libunwind-0.99.tar.gz</a><br>tar zxvf libunwind-0.99.tar.gz<br>cd libunwind-0.99/<br>CFLAGS=-fPIC ./configure<br>make CFLAGS=-fPIC<br>make CFLAGS=-fPIC install</p>
<p>2、安装google-perftools：  </p>
<p>wget <a href="http://google-perftools.googlecode.com/files/google-perftools-1.6.tar.gz" target="_blank" rel="noopener">http://google-perftools.googlecode.com/files/google-perftools-1.6.tar.gz</a><br>tar zxvf google-perftools-1.6.tar.gz<br>cd google-perftools-1.6/<br>./configure<br>make &amp;&amp; make install<br>echo “/usr/local/lib” &gt;/etc/ld.so.conf.d/usr_local_lib.conf<br>/sbin/ldconfig</p>
<p>3、修改MySQL启动脚本（根据你的MySQL安装位置而定）：  </p>
<p>vi /usr/local/mysql/bin/mysqld_safe</p>
<p>　　在# executingmysqld_safe的下一行，加上：  </p>
<p>export LD_PRELOAD=/usr/local/lib/libtcmalloc.so</p>
<p>保存后退出，然后重启MySQL服务器。  </p>
<p>4、使用lsof命令查看tcmalloc是否起效： lsof -n | grep tcmalloc</p>
<p>如果发现以下信息，说明tcmalloc已经起效：  </p>
<p>mysqld 10847 mysql mem REG 8,5 1203756 20484960/usr/local/lib/libtcmalloc.so.0.0.0</p>
<p>四.安装配置Bind-DLZ 及相关脚本  </p>
<p>1．安装bind</p>
<p>#mkdir /usr/local/src/bind-dlz  </p>
<p>#cd /usr/local/src/bind-dlz  </p>
<p>#wget <a href="http://ftp.isc.org/isc/bind9/9.6.0-P1/bind-9.6.0-P1.tar.gz" target="_blank" rel="noopener">http://ftp.isc.org/isc/bind9/9.6.0-P1/bind-9.6.0-P1.tar.gz</a>  </p>
<p>#tar zxvf bind-9.6.0-P1.tar.gz</p>
<p>#cd bind-9.6.0-P1  </p>
<p>#./configure –with-dlz-mysql –enable-largefile –enable-threads=no–prefix=/usr/local/bind</p>
<p>#make –j4 &amp;&amp; make install</p>
<p>2.创建相关配置文件  </p>
<p>cd /usr/local/bind/etc<br>../sbin/rndc-confgen &gt;rndc.conf<br>tail -n10 rndc.conf | head -n9 | sed -e s/#\//g &gt;named.conf</p>
<p># vilocalhost.zone</p>
<p>ttl 86400<br>@ IN SOA localhost. root.localhost. (<br>1997022700 ; Serial<br>28800 ; Refresh<br>14400 ; Retry<br>3600000 ; Expire<br>86400 ) ; Minimum<br>IN NS localhost.<br>1 IN PTR localhost.</p>
<p># dig &gt;named.root  </p>
<p>#vi named.conf 在后面加入如下：  </p>
<p>include”/usr/local/bind/etc/cnc_acl.conf”; //网通ACL<br>include “/usr/local/bind/etc/telecom_acl.conf”; //电信ACL<br>include “/usr/local/bind/etc/edu_acl.conf”; //教育网ACL<br>include “/usr/local/bind/etc/view.conf”; //DLZ相关的配</p>
<p>3、配置DNSTSIG</p>
<p>1、使用dnssec-keygenfunction 产生加密密钥，一个为public key,另一  </p>
<p>个为private key,本文假设应用服务器存在CNC,TELECOM,EDU,ANY</p>
<p>(1)产生加密金钥  </p>
<p>#cd /usr/local/bind/sbin</p>
<p>#./dnssec-keygen -a hmac-md5 -b 128 -n HOSTcnc</p>
<p>#./dnssec-keygen -a hmac-md5 -b 128 -n HOSTtelecom</p>
<p>#./dnssec-keygen -ahmac-md5 -b 128 -n HOST edu  </p>
<p>#./dnssec-keygen -a hmac-md5 -b 128 -n HOST any<br>(2)查看生成的密钥文件  </p>
<p># cat Kcnc.+157+24406.private //以网通为例.</p>
<p>Private-key-format: v1.2</p>
<p>Algorithm: 157 (HMAC_MD5)</p>
<p>Key: YTjTOw00PzeEaasA16/Rvw==</p>
<p>Bits: AAA=</p>
<p>将:YTjTOw00PzeEaasA16/Rvw== 加入到named.conf，其它同例。  </p>
<p>详细请参照named.conf配置文件  </p>
<p>2、配置named.conf  </p>
<p>#vi /usr/local/bind/etc/named.conf  </p>
<p>key “rndc-key” {</p>
<p>algorithm hmac-md5;</p>
<p>secret “5PubnjGuAWeH9F2dIUYd6g==”;</p>
<p>};</p>
<p>controls {</p>
<p>inet 127.0.0.1 port 953</p>
<p>allow { 127.0.0.1; } keys {“rndc-key”; };</p>
<p>};</p>
<p>#</p>
<p>options {</p>
<p>directory “/usr/local/bind/etc”;</p>
<p>pid-file “named.pid”;</p>
<p>};</p>
<p>#TSIG-key</p>
<p>key “cnc” {</p>
<p>algorithm hmac-md5;</p>
<p>secret “YTjTOw00PzeEaasA16/Rvw==”;</p>
<p>};</p>
<p>key “telecom” {</p>
<p>algorithm hmac-md5;</p>
<p>secret”pUcQGLpSH2tQgVZ9ZHU6Yg==”;</p>
<p>};</p>
<p>key “edu”{</p>
<p>algorithm hmac-md5;</p>
<p>secret”Bzo6MTzrzbRFQbONYTS1Cw==”;</p>
<p>};</p>
<p>key “any”{</p>
<p>algorithm hmac-md5;</p>
<p>secret”DHpPfGJdMLv91OygBf9H6w==”;</p>
<p>};</p>
<p>#acl</p>
<p>acl”dns-ip-list”{</p>
<p>172.19.3.15; #masterDNS IP</p>
<p>172.19.1.3; #slaveDNS IP</p>
<p>};</p>
<p>#acl include</p>
<p>include”/usr/local/bind/etc/cnc_acl.conf”; //网通ACL</p>
<p>include”/usr/local/bind/etc/telecom_acl.conf”; //电信 ACL</p>
<p>include”/usr/local/bind/etc/edu_acl.conf”; //教育网ACL</p>
<p>incl ude”/usr/local/bind/etc/view.conf”; //bind-view部分  </p>
<p>3．Bind 启动脚本</p>
<p>#!/bin/sh</p>
<p># powered bydz<a href="http://www.com" target="_blank" rel="noopener">www.com</a></p>
<p>case”$1” in</p>
<p>start)</p>
<p>if [ -x/usr/local/bind/sbin/named ]; then</p>
<p>/usr/local/bind/sbin/named-c /usr/local/bind/etc/named.conf -u bind</p>
<p>echo”BIND9-named server started”</p>
<p>fi</p>
<p>;;</p>
<p>stop)</p>
<p>kill `cat/usr/local/bind/etc/named.pid` &amp;&amp; echo . &amp;&amp; echo ‘BIND9 serverstopped’</p>
<p>;;</p>
<p>restart)</p>
<p>echo .</p>
<p>echo”Restart BIND9 server”</p>
<p>$0 stop</p>
<p>sleep 10</p>
<p>$0 start</p>
<p>;;</p>
<p>reload)</p>
<p>/usr/local/bind/sbin/rndcreload</p>
<p>;;</p>
<p>status)</p>
<p>/usr/local/bind/sbin/rndcstatus</p>
<p>;;</p>
<p>*)</p>
<p>echo”$0 start | stop | restart |reload |status”</p>
<p>;;</p>
<p>esac</p>
<p>./bind9 start 启动bind；./bind9 stop停止bind;<br>./bind9 reload #重载配置文件  </p>
<p>剩余文档见打包的bind-dlz.tar.gz。里面很详细。部署的master时候用tar zvxf bind-dlz-tar.gz –C /usr/local/bind/etc覆盖即可，剩下的slave在部署bind还是将配置文件解压到/usr/local/bind/etc/即可，将rndc-key 和dnssec重新配置一遍就可以用了！</p>
<p>部署DNS，防火墙和路由器要设置清楚，我部署的时候就是因为黑洞防火墙没有对master和slave服务器开放tcp和udp53端口，造成不能解析域名。需要大家切记！<br>MYSQL Master info  </p>
<p><img src="http://bbs.linuxtone.org/data/attachment/forum/201010/27/004210fdskdppmrcpwk4r4.jpg" alt="1.jpg" title="1.jpg"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2010/11/01/the-netfile-table-is-full-the-connection-exception-and-the-local-port-is-full/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2010/11/01/the-netfile-table-is-full-the-connection-exception-and-the-local-port-is-full/" itemprop="url">netfile表满了，连接异常，和本地端口满了，</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-11-01T16:52:25+08:00">
                2010-11-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>net.ipv4.ip_conntrack_max = 65536</p>
<p>iptables的连接跟踪池满了</p>
<p>net.ipv4.ip_conntrack_max = 65536，这个满了</p>
<p>满了以后iptables就开始丢包了</p>
<p>sysctl -w net.ipv4.ip_conntrack_max=1048576</p>
<p>本地端口满了</p>
<p>net.ipv4.ip_local_port_range = 32768    61000</p>
<p>修改可以端口</p>
<p> sysctl -w net.ipv4.ip_local_port_range=”1025 65534”</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">277</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">163</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
