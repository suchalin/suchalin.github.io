<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="haitian的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="haitian的博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="haitian的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>haitian的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">haitian的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">为了更好的生活而奋斗!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2012/07/06/vsftpd-virtual-users-and-local-users-can-t-coexist-solutions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/07/06/vsftpd-virtual-users-and-local-users-can-t-coexist-solutions/" itemprop="url">vsftpd虚拟用户和本地用户不能共存的解决方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-07-06T10:45:36+08:00">
                2012-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在配置vsftpd的过程中，听信了网上的谗言，把vsftpd配了一遍，发现配完，虚拟用户和本地用户不能共存，即虚拟用户可以登录ftp，但是本地用 户不能登录的ftp。折腾了很久，包括上网找过很多内容都找不到解决方法，大家貌似都没有这样的问题，或者找不到解决办法（在看众多教程中貌似有看到过和 本方法一样的配置，但是那份内容里面完全没有提到/etc/pam.d/vsftpd里面为什么要这样写）。在洗澡过程中想了想，既然本地用户无法登录， 那应该是pam验证的时候就没有给本地用户过。实验证明人在洗澡的时候是最清醒的时候。哈哈！回来实验，发现如果把/etc/pam.d/vsftpd 中的  </p>
<p>auth required pam_userdb.so db=/etc/vsftpd/vuser_passwd<br>account required pam_userdb.so db=/etc/vsftpd/vuser_passwd  </p>
<p>注 释掉，然后把里面其它的内容都打开注释（网上大部分教程教建立虚拟用户时，都说把上面两句加入/etc/pam.d/vsftpd中，然后把里面的其它东 西注释掉），这时候再尝试，发现本地用户能登录！！！这也证明了是pam模块认证的问题让虚拟用户和本地用户不能共存。所以就去了解了一下pam配置的内 容，如下网址：  </p>
<p><a href="http://www.ibm.com/developerworks/cn/linux/l-pam/" target="_blank" rel="noopener">http://www.ibm.com/developerworks/cn/linux/l-pam/</a>  </p>
<p>里面提到：<br>Required：堆栈中的所有 Required 模块必须看作一个成功的结果。如果一个或多个 Required 模块失败，则实现堆栈中的所有 Required 模块，但是将返回第一个错误。  </p>
<p>也 就意味着，required需要所有内容都满足才行，当我们前两条配置虚拟用户登录验证通过后，继续向下面的配置条目进行验证，验证是否是本地用户时结果 发现不是，又因为，验证本地用户的control_flag(见上网址中解释)也为required，所以这时候，就会返回错误，也即验证不成功。  </p>
<p>所以我们不能同时设置虚拟用户和本地用户的control_flag为required。按照上面的网址所说：<br>Sufficient：如果标记为 sufficient 的模块成功并且先前没有 Required 或 sufficient 模块失败，则忽略堆栈中的所有其余模块并返回成功。  </p>
<p>我们可以把虚拟用户的验证配置放在最前面，且把control_flag设为sufficient。这样的话，如果遇到是虚拟用户，那么可以通过验证，如果是本地用户，忽略掉sufficient的两条配置规则，只要满足required就行，所以也能通过验证。  </p>
<p>如下为/etc/pam.d/vsftpd的内容：  </p>
<p>#%PAM-1.0<br>auth sufficient pam_userdb.so db=/etc/vsftpd/vuser_passwd<br>account sufficient pam_userdb.so db=/etc/vsftpd/vuser_passwd  </p>
<p>session optional pam_keyinit.so force revoke<br>auth required pam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed<br>auth required pam_shells.so<br>auth include password-auth<br>account include password-auth<br>session required pam_loginuid.so<br>session include password-auth  </p>
<p>上 面两行为后面加上，虚拟用户pam认证需要的配置条目，下面为原来vsftpd的认证配置规则，可以看到，本地用户用的是password-auth，从 这里可以看出如果要虚拟用户和本地用户共存，两部分都不能注释。网上说的注释掉下面的部分，这种情况本地用户都不能登录。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2012/01/17/kvm-image-snapshot-function-experiment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/01/17/kvm-image-snapshot-function-experiment/" itemprop="url">KVM镜像快照功能实验小记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-01-17T14:19:03+08:00">
                2012-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>-snapshot       write to temporary files instead of disk image files  </p>
<p>意思是不更改镜像文件，启动后的所有改动均不会往镜像文件上写。临时文件存放在内存中了，具体是cached  </p>
<p>感觉这个解释有点问题，晚上闲来无事，就简单做了个测试，实验过程如下：  </p>
<p>使用libvirt创建的虚拟机，默认格式为raw，要想使用快照功能，需要先将其转换格式。  </p>
<p>1：qemu-img  snapshot  -c   base_sys_centos5.564bit.img   CentOS5.5_64bit.img<br>在现有镜像基础上创建一个快照。<br>报如下错误：<br>emu-img: Could not create snapshot ‘base_sys_centos5.564bit.img’: -95 (Operation not supported）  </p>
<p>2：怀疑是文件格式不对，查看一下。<br>qemu-img   info    CentOS5.5_64bit.img<br>image: CentOS5.5_64bit.img<br>file format: raw<br>virtual size: 20G (21474836480 bytes)<br>disk size: 3.4G  </p>
<p>果然是raw格式  </p>
<p>3：使用如下命令将raw格式的镜像转化为qcow2格式。<br>qemu-img   convert   -f  raw   -O qcow2    CentOS5.5_64bit.img    CentOS5.5_64bit_basesys_qcow2.img  </p>
<p>4：转换成功后，再次对镜像创建一个快照  </p>
<p>qemu-img snapshot -c CentOS5.5_64bit_Qcow2_basesys.img CentOS5.5_64bit_Qcow2.img  </p>
<p>OK，创建成功。  </p>
<p>该步并不会创建一个新的镜像，可以使用如下命令来查看指定的镜像上是否存在快照，并在合适的时候，恢复快照。  </p>
<p>qemu-img  snapshot -l CentOS5.5_64bit_Qcow2.img  </p>
<p>Snapshot list:<br>ID        TAG                 VM SIZE                DATE       VM CLOCK<br>1         CentOS5.5_64bit_Qcow2_basesys.img      0 2011-07-21 23:17:38   00:00:00.000  </p>
<p>恢复快照：  </p>
<p>qemu-img  snapshot   -a   CentOS5.5_64bit_Qcow2_basesys.img    CentOS5.5_64bit_Qcow2.img  </p>
<p>其他操作：  </p>
<p>  ‘snapshot’ is the name of the snapshot to create, apply or delete<br>  ‘-a’ applies a snapshot (revert disk to saved state)<br>  ‘-c’ creates a snapshot<br>  ‘-d’ deletes a snapshot  </p>
<h1 id="‘-l’-lists-all-snapshots-in-the-given-image"><a href="#‘-l’-lists-all-snapshots-in-the-given-image" class="headerlink" title="  ‘-l’ lists all snapshots in the given image"></a>  ‘-l’ lists all snapshots in the given image</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/12/25/how-do-i-find-the-process-that-currently-consumes-the-most-disk-io/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/12/25/how-do-i-find-the-process-that-currently-consumes-the-most-disk-io/" itemprop="url">如何找出当前占用磁盘IO最多的进程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-12-25T16:52:39+08:00">
                2011-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>linux系统上可以使用（centos 2.6.18-144开始支持），dstat版本至少是：dstat-0.6.7-1.rf.noarch.rpm<br>安装<br>wget -c <a href="http://linux.web.psi.ch/dist/scientific/5/gfa/all/dstat-0.6.7-1.rf.noarch.rpm" target="_blank" rel="noopener">http://linux.web.psi.ch/dist/scientific/5/gfa/all/dstat-0.6.7-1.rf.noarch.rpm</a><br>rpm -Uvh dstat-0.6.7-1.rf.noarch.rpm</p>
<p>使用<br># dstat -M topio -d -M topbio<br><img src="http://www.517sou.net/Attach/month_1109/2crtq0_083334_1.jpg" alt="" title="如何找出当前占用磁盘IO最多的进程 - suchalin - 态度决定高度">  </p>
<p>Linux Kernel 2.6.20 以上的内核支持进程 IO 统计，可以用类似 iotop 这样的工具来监测每个进程对 IO 操作的情况，就像用 top 来实时查看进程内存、CPU 等占用情况那样。但是对于 2.6.20 以下的 Linux 内核版本就没那么幸运了，根据 <a href="http://stackoverflow.com/questions/249570/" target="_blank" rel="noopener">Stack Overflow 的这篇回帖</a> 给出的方法，VPSee 写了一个简单的 Python 脚本用来在 linux kernel &lt; 2.6.20 下打印进程 IO 状况。</p>
<h2 id="Kernel-lt-2-6-20"><a href="#Kernel-lt-2-6-20" class="headerlink" title="Kernel &lt; 2.6.20"></a>Kernel &lt; 2.6.20</h2><p>这个脚本的想法很简单，把 dmesg 的结果重定向到一个文件后再解析出来，每隔1秒钟打印一次进程 IO 读写的统计信息，执行这个脚本需要 root：</p>
<p>#!/usr/bin/python # Monitoring per-process disk I/O activity # written by <a href="http://www.vpsee.com" target="_blank" rel="noopener">http://www.vpsee.com</a>  import sys, os, time, signal, re class DiskIO:     def __init__(self, pname=None, pid=None, reads=0, writes=0):         self.pname = pname         self.pid = pid         self.reads = 0         self.writes = 0 def main():     argc = len(sys.argv)     if argc != 1:         print “usage: ./iotop”         sys.exit(0)     if os.getuid() != 0:         print “must be run as root”         sys.exit(0)     signal.signal(signal.SIGINT, signal_handler)     os.system(‘echo 1 &gt; /proc/sys/vm/block_dump’)     print “TASK              PID       READ      WRITE”     while True:         os.system(‘dmesg -c &gt; /tmp/diskio.log’)         l = []         f = open(‘/tmp/diskio.log’, ‘r’)         line = f.readline()         while line:             m = re.match(\                 ‘^(\S+)\((\d+)\): (READ|WRITE) block (\d+) on (\S+)’, line)             if m != None:                 if not l:                     l.append(DiskIO(m.group(1), m.group(2)))                     line = f.readline()                     continue                 found = False                 for item in l:                     if item.pid == m.group(2):                         found = True                         if m.group(3) == “READ”:                             item.reads = item.reads + 1                         elif m.group(3) == “WRITE”:                             item.writes = item.writes + 1                 if not found:                     l.append(DiskIO(m.group(1), m.group(2)))             line = f.readline()         time.sleep(1)         for item in l:             print “%-10s %10s %10d %10d” % \                 (item.pname, item.pid, item.reads, item.writes) def signal_handler(signal, frame):     os.system(‘echo 0 &gt; /proc/sys/vm/block_dump’)     sys.exit(0) if __name__==”__main__“:     main() </p>
<h2 id="Kernel-gt-2-6-20"><a href="#Kernel-gt-2-6-20" class="headerlink" title="Kernel &gt;= 2.6.20"></a>Kernel &gt;= 2.6.20</h2><p>如果想用 iotop 来实时查看进程 IO 活动状况的话，需要下载和升级新内核（2.6.20 或以上版本）。编译新内核时需要打开 TASK_DELAY_ACCT 和 TASK_IO_ACCOUNTING 选项。解压内核后进入配置界面：</p>
<p># tar jxvf linux-2.6.30.5.tar.bz2 # mv linux-2.6.30.5 /usr/src/ # cd /usr/src/linux-2.6.30.5 # make menuconfig </p>
<p>选择 Kernel hacking –&gt; Collect scheduler debugging info 和 Collect scheduler statistics，保存内核后编译内核：</p>
<p># make; make modules; make modules_install; make install </p>
<p>修改 grub，确认能正确启动新内核：</p>
<p># vi /boot/grub/menu.lst </p>
<p>出了新内核外，iotop 还需要 Python 2.5 或以上才能运行，所以如果当前 Python 是 2.4 的话需要下载和安装最新的 Python 包。这里使用源代码编译安装：</p>
<p># tar jxvf Python-2.6.2.tar.bz2 # cd Python-2.6.2 # ./configure # make; make install </p>
<p>别忘了下载 setuptools：</p>
<p># mv setuptools-0.6c9-py2.6.egg.sh setuptools-0.6c9-py2.6.egg # sh setuptools-0.6c9-py2.6.egg </p>
<h2 id="更多信息"><a href="#更多信息" class="headerlink" title="更多信息"></a>更多信息</h2><p>如果想知道更多关于 block_dump 的信息，可以看看这篇 <a href="http://www.vpsee.com/2010/07/monitoring-process-io-activity-on-linux-with-block_dump/" target="_blank" rel="noopener">监测 Linux 进程的实时 IO 情况</a>。使用 block_dump 的时候，最好能关掉 klogd 进程。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/12/10/use-zssh-to-transfer-files-remotely/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/12/10/use-zssh-to-transfer-files-remotely/" itemprop="url">使用zssh远程传送文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-12-10T11:53:50+08:00">
                2011-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>zssh的全名叫ZMODEM SSH.看名字就知道，使用的zmodem，我们习惯了SecureCRT,直接就可以用来发送文件，比使用scp方便很多。</p>
<p>zmodem协议方便主要表示在以下点</p>
<p>其一,不需要输入很长的命令和密码，直接使用rz,sz加文件名，就能实现文件的收发。速度还很快。</p>
<p>其二,在中转了一台主机时，要在目标主机和本地主机之类，要传送文件，scp相当的麻烦，需要输入多次命令用户密码.但sz直接可以穿透。</p>
<p>好了，讲使用,如下，和使用ssh完全一样，只是打命令时，变成了zssh</p>
<p><strong>#zssh <a href="mailto:root@www.php-oa.com" target="_blank" rel="noopener">root@www.php-oa.com</a></strong></p>
<p>好了，在进入后，你需要<strong>上传</strong>文件的话。先</p>
<p>**#ctrl+@  </p>
<blockquote>
<p>sz filename**[可选参数-be:二进制方式]</p>
</blockquote>
<p><strong>下载</strong>文件的话</p>
<p><strong>#sz filename</strong><br>然后在</p>
<p>**#ctrl+@  </p>
<blockquote>
<p>rz**</p>
</blockquote>
<p><strong>zssh&gt; exit</strong> 回到远程服务器 使用也是相当的方便</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/11/24/linux-uses-the-find-file-to-exclude-folders-from-the-prune/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/11/24/linux-uses-the-find-file-to-exclude-folders-from-the-prune/" itemprop="url">linux用find文件，用-prune排除文件夹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-11-24T17:01:49+08:00">
                2011-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>linux下的常用命令find，加上不同的参数，可以使你很容易的找到需要的文件，但是有些时候，你在查找文件的同时，可能不需要在某文件夹下查找，这时候-prune就用上了。</p>
<p>比如在当前目录下寻找pl后缀的文件，不在scripts下寻找。</p>
<p>find . -path ‘./scripts’ -prune -o -name ‘*.pl’ -print</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/11/19/how-do-i-put-an-auto-mounted-disk-on-the-desktop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/11/19/how-do-i-put-an-auto-mounted-disk-on-the-desktop/" itemprop="url">如何将自动挂载的磁盘不显示在桌面上</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-11-19T09:25:02+08:00">
                2011-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>如何将自动挂载的磁盘不显示在桌面上？！<br>解决方案：<br>安装Configuration Editor，使用yum来安装是最简单的：[img=16,16]<a href="http://www.im321.com/blog/images/quote.gif[/img]" target="_blank" rel="noopener">http://www.im321.com/blog/images/quote.gif[/img]</a> 引用内容<br>sudo yum -y install gconf-editor  </p>
<p>打开Configuration Editor，找到/apps/nautilus/desktop/volumes_visible，取消前面的勾即可。  </p>
<p>顺便提示一下，所有经过Configuration Editor编辑的内容，都可以在 ~/.gconf/找到相应的配置文件。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/11/16/centos-simply-uses-yum-to-upgrade-python-to-2-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/11/16/centos-simply-uses-yum-to-upgrade-python-to-2-6/" itemprop="url">CentOS中简单用yum升级 Python 至2.6</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-11-16T09:56:17+08:00">
                2011-11-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>CentOS 在当前最新的 5.6 版中，其 python 的版本依然比较落后，还是古老的 2.4。</p>
<p>但是有些程序需要 2.6 才跑得起来，编译安装的话，又太麻烦，而且不适合菜鸟使用。</p>
<p>下面就给出使用 yum 升级 python 至 2.6 的简单方案。</p>
<p> 1: rpm -Uvh <a href="http://download.fedora.redhat.com/pub/epel/5Server/i386/epel-release-5-4.noarch.rpm" target="_blank" rel="noopener">http://download.fedora.redhat.com/pub/epel/5Server/i386/epel-release-5-4.noarch.rpm</a></p>
<p> 2: yum install libffi -y</p>
<p> 3: yum install python26 -y</p>
<p> 4: rm -f /usr/bin/python</p>
<p> 5: ln -s /usr/bin/python26 /usr/bin/python</p>
<p>如果是 64 位的 CentOS，则将上述第一句代码中的 i386 改为 x86_64 即可。</p>
<p>运行完毕后，此时系统默认的 python 已经是 2.6 版了。</p>
<p>然而，yum 是基于 python2.4 的，因此会出现故障。解决方法也很简单：</p>
<p> 1: nano /usr/bin/yum</p>
<p>将第一行末的 python 后加上 2.4，即将第一行改为：</p>
<p>#!/usr/bin/python2.4</p>
<p>这样，yum 依然使用 python 2.4 环境运行，一切恢复正常。</p>
<p>此时我们输入 python -V 即可看到当前的 python 版本：</p>
<p> 1: # python -V</p>
<p> 2: Python 2.6.5</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/11/14/why-does-red-hat-enterprise-linux-system-does-not-respond-to-syn-requests-intermittently-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/11/14/why-does-red-hat-enterprise-linux-system-does-not-respond-to-syn-requests-intermittently-2/" itemprop="url">Why does Red Hat Enterprise Linux system does not respond to SYN requests intermittently ?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-11-14T16:26:24+08:00">
                2011-11-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Why-does-Red-Hat-Enterprise-Linux-system-does-not-respond-to-SYN-requests-intermittently"><a href="#Why-does-Red-Hat-Enterprise-Linux-system-does-not-respond-to-SYN-requests-intermittently" class="headerlink" title="Why does Red Hat Enterprise Linux system does not respond to SYN requests intermittently ?"></a>Why does Red Hat Enterprise Linux system does not respond to SYN requests intermittently ?</h2><h3 id="Article-ID-40006-Created-on-Aug-17-2009-7-48-AM-Last-Modified-Sep-13-2010-6-13-AM"><a href="#Article-ID-40006-Created-on-Aug-17-2009-7-48-AM-Last-Modified-Sep-13-2010-6-13-AM" class="headerlink" title="Article ID: 40006 - Created on: Aug 17, 2009 7:48 AM - Last Modified:  Sep 13, 2010 6:13 AM"></a>Article ID: 40006 - Created on: Aug 17, 2009 7:48 AM - Last Modified:  Sep 13, 2010 6:13 AM</h3><h3 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h3><ul>
<li>Server does not answer some specific SYN Packages.</li>
<li>Webserver does not respond for some sessions (SYN requests).  SYN Packets being ignored intermittently by RHEL Apache server</li>
<li>LDAP server occasionally ignoring SYNs</li>
<li>Any server, regardless of the application layer, may occasionally ignore TCP SYN packets (i.e. a TCP packet with the SYN flag set).</li>
</ul>
<h3 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h3><ul>
<li>Red Hat Enterprise Linux 4 and 5 (Webserver/application server)</li>
<li>Red Hat Enterprise Linux 5.4 (openldap-2.3.43-3.el5)</li>
</ul>
<p>This issue has been reported in a environment using NAT (Network Address Translation) like the following:<br>      <strong>Client**</strong>—&gt;<strong><strong>NAT Router</strong></strong>—&gt;<strong>**Server</strong></p>
<h3 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h3><p>Disable TCP time stamps using the following command:</p>
<pre><code>echo 0 &gt; /proc/sys/net/ipv4/tcp_timestamps
</code></pre><p>or by adding the following line to /etc/systcl.conf and rebooting the system:</p>
<pre><code>net.ipv4.tcp_timestamps = 0
</code></pre><p>Disabling TCP time stamps will disable PAWS (Protect Against Wrapped Sequences), checking as defined in <a href="http://www.ietf.org/rfc/rfc1323.txt" target="_blank" rel="noopener">RFC 1323</a>.</p>
<h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a>Root Cause</h3><p>In a TCP dump of the affected packets, the TSVal of SYN packet is a lower value than the preceding packet.</p>
<pre><code>Packet #30 from x.x.x.x to y.y.y.y has a TSval of 773695118

Packet #33 from x.x.x.x to y.y.y.y has a TSval of 470318331
</code></pre><p>In above TCP trace, packet #33 has a TSval of 470318331 which is lower than its preceding one. As PAWS checking is enabled in the TCP stack, it doesn’t send an acknowledge (SYN-ACK) back to the peer.</p>
<p>PAWS assumes that every received TCP segment (including data and ACK segments) contains a timestamp (SEG.TSval) whose values are non-decreasing in time. The basic idea is that a segment can be discarded as an old duplicate if it is received with a timestamp (SEG.TSval) less than some timestamp recently received on this connection.</p>
<p>Timestamp issues often indicate a problem with firewalls or NAT routers.</p>
<h3 id="Diagnostic-Steps"><a href="#Diagnostic-Steps" class="headerlink" title="Diagnostic Steps"></a>Diagnostic Steps</h3><h6 id="Stage-1"><a href="#Stage-1" class="headerlink" title="Stage 1"></a>Stage 1</h6><p>Since the server is not heavily loaded, you may at first suspect this issue to be an issue with socket exhaustion.  However, checking the output of “netstat -paunt” will reveal that there are only a couple of active connections.</p>
<h6 id="Stage-2"><a href="#Stage-2" class="headerlink" title="Stage 2"></a>Stage 2</h6><p>Increasing the size of syn backlog queue (net.ipv4.tcp_max_syn_backlog) doesn’t seem to help.</p>
<h6 id="Stage-3"><a href="#Stage-3" class="headerlink" title="Stage 3"></a>Stage 3</h6><p>Collecting a TCP dump from the server using a command like the following:</p>
<pre><code>tcpdump -s0 -w /tmp/tcpdump.pcap -i any host &lt;client ip&gt; and port 80
</code></pre><p>and generating traffic (HTTP or LDAP) to the server captures evidence of the server not responding to the TCP SYN packets.  The output file can be analyzed with a command like</p>
<pre><code>tcpdump -r /&lt;path&gt;/&lt;to&gt;/tcpdump.pcap
</code></pre><p>or <a href="http://www.wireshark.org/" target="_blank" rel="noopener">Wireshark</a> can be used to analyze the TCP dump file graphically.  Wireshark is a standard package in most Red Hat Enterprise Linux and Fedora distributions.  Analysis of the TCP dump should show cases where the client will send several TCP SYN packets to the host, but the host will not respond.  Further analysis should show that the TSVal of the SYN packets is less than a preceding TCP packet.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/11/03/use-xcutsel-to-transmit-clipboard-contents-in-vncviewer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/11/03/use-xcutsel-to-transmit-clipboard-contents-in-vncviewer/" itemprop="url">使用xcutsel在vncviewer中传输剪贴板内容</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-11-03T12:32:01+08:00">
                2011-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/默认分类/" itemprop="url" rel="index">
                    <span itemprop="name">默认分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>找到了如下方法支持clipboard传输：  </p>
<p>在xstartup的最后一行加入命令：  </p>
<p>xcutsel &amp;  </p>
<p>这样在gnome桌面环境启动后会出现一个小小的程序，里面有3项：<br>1，quit<br>2，copy primary to 0<br>3，copy 0 to primary  </p>
<p>在WinXP中复制ASCII内容后，点击3:copy 0 to primary，然后在gnome环境中点击鼠标中键，即可实现clipboard transfer。  </p>
<p>同理，在gnome环境中复制ASCII内容后，点击2:copy primary to 0，然后就可以复制到WinXP中了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/10/17/the-default-rsync-bug-in-redhat5-4-5-5-5-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="haitian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haitian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/10/17/the-default-rsync-bug-in-redhat5-4-5-5-5-6/" itemprop="url">在redhat5.4/5.5/5.6中默认的rsync出现的bug</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-10-17T11:23:12+08:00">
                2011-10-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>测试环境为：</p>
<p>Client(192.168.1.3)——————–àdaemon(192.168.1.2)</p>
<p>———————–配置过的先略过，直接看测试过程—————-</p>
<p>服务端配置：</p>
<p>/etc/rsyncd/Rsyncd.conf配置</p>
<p># Minimal configuration file for rsync daemon</p>
<p># See rsync(1) and rsyncd.conf(5) man pages for help</p>
<p># This line is required by the /etc/init.d/rsyncd script</p>
<p>pid file = /var/run/rsyncd.pid  </p>
<p>port = 873</p>
<p>address = 192.168.1.2</p>
<p>uid = test</p>
<p>gid = test</p>
<p>auth users = test</p>
<p>secrets file = /etc/rsyncd/rsyncd.secrets </p>
<p>#incoming chmod = u+rwx,g+rwx,o+rx</p>
<p>use chroot = yes </p>
<p>read only = no </p>
<p>#limit access to private LANs</p>
<p>hosts allow=192.168.1.3/255.255.255.255</p>
<p>hosts deny=*</p>
<p>max connections = 500</p>
<p>#This will give you a separate log file</p>
<p>log file = /var/log/rsync.log</p>
<p>#This will log every file transferred - up to 85,000+ per user, per sync</p>
<p>#transfer logging = yes</p>
<p>log format = %t %a %m %f %b</p>
<p>syslog facility = local3</p>
<p>timeout = 300</p>
<p>[app]  </p>
<p>path = /app/test（目标目录）</p>
<p>list=yes</p>
<p>#ignore errors</p>
<p>/etc/rsyncd/rsyncd.secrets  配置</p>
<p>test:123456（密码）</p>
<p>启动服务端/usr/bin/rsync –daemon –config=/etc/rsyncd/rsyncd.conf</p>
<p>客户端配置</p>
<p>客户端：</p>
<p>/etc/rsync_client.pass</p>
<p>123456（密码）</p>
<p>rsync -av  –password-file=/etc/rsync_client.pass /boot <a href="mailto:audit@192.168.1.2::app" target="_blank" rel="noopener">test@192.168.1.2::app</a></p>
<p>————————————————————-配置完成————————————————-</p>
<p>测试过程：</p>
<p>rsync -av  –password-file=/etc/rsync_client.pass /boot <a href="mailto:audit@192.168.1.2::app" target="_blank" rel="noopener">test@192.168.1.2::app</a></p>
<p>结果正确，没有出现问题</p>
<p>再进行</p>
<p>rsync -av  –password-file=/etc/rsync_client.pass /home <a href="mailto:audit@192.168.1.2::app" target="_blank" rel="noopener">test@192.168.1.2::app</a></p>
<p>结果也正确，没有出现问题</p>
<p>再进行</p>
<p>rsync -av  –password-file=/etc/rsync_client.pass /etc <a href="mailto:audit@192.168.1.2::app" target="_blank" rel="noopener">test@192.168.1.2::app</a></p>
<p>这回报错了</p>
<p>出现如下错误：</p>
<p>unexpected tag 3 [sender]</p>
<p>rsync error: error in rsync protocol data stream (code 12) at io.c(828)</p>
<p>[sender=2.6.8]</p>
<p>而此时服务端的错误日志如下：</p>
<p>2008/11/12 00:25:42 [12657] rsync: read error: Connection reset by peer (104)</p>
<p>2008/11/12 00:25:42 [12657] rsync error: error in rsync protocol data stream</p>
<p>(code 12) at io.c(614) [receiver=2.6.8]</p>
<p>2008/11/12 00:25:42 [12657] rsync: connection unexpectedly closed (486 bytes</p>
<p>received so far) [generator]</p>
<p>2008/11/12 00:25:42 [12657] rsync error: error in rsync protocol data stream</p>
<p>(code 12) at io.c(463) [generator=2.6.8]</p>
<p>再同步一次就成功。</p>
<p>把服务端下已经同步的文件删除，再不尝试一次</p>
<p>rsync -av  –password-file=/etc/rsync_client.pass /etc <a href="mailto:audit@192.168.1.2::app" target="_blank" rel="noopener">test@192.168.1.2::app</a></p>
<p>还是报错。文件只同步了部分文件，发现在同步的源文件中如果文件数太多，或者子目录太多，就经常会出现这一种情况。</p>
<p>根据多次查找发现在2.6.8上会出现这一个问题，在2.6.9上已经解决，经查看在redhat5.4，5.5和5.6的发行版中都是使用rsync-2.6.8的版本。</p>
<p><a href="http://rsync.samba.org/ftp/rsync/src/rsync-2.6.9-NEWS" target="_blank" rel="noopener">http://rsync.samba.org/ftp/rsync/src/rsync-2.6.9-NEWS</a>在官方上看到了更新日志</p>
<p>- Fixed a bug where a deferred info/error/log message could get sent directly to the sender instead of being handled by rwrite() in the generator. This fixes an “unexpected tag 3” fatal error, and should also fix a potential problem where a deferred info/error message from the receiver might bypass the log file and get sent only to the client process. (These problems could only affect an rsync daemon that was receiving files.)</p>
<p>Redhat上的bug报告文件如下：</p>
<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=471182" target="_blank" rel="noopener">https://bugzilla.redhat.com/show_bug.cgi?id=471182</a></p>
<p>解决方法：</p>
<p>升级rsync到2.6.9以上，只需要升级服务器端就可以了！因为这一个bug只会影响服务端的接收。</p>
<p>在redhat5.7中已经默认修复了这一个问题。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://q1.qlogo.cn/g?b=qq&nk=493654134&s=5"
                alt="haitian" />
            
              <p class="site-author-name" itemprop="name">haitian</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">277</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">163</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">haitian</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
